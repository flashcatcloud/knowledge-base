---
title: "Android RUM SDK Integration Guide"
description: "This document provides detailed instructions on how to integrate the FlashCat RUM SDK into Android applications."
date: "2024-05-09T10:00:00+08:00"
url: "https://docs.flashcat.cloud/en/flashduty/rum/android-sdk-integration"
---

## Overview

FlashCat Android RUM SDK supports Android 6.0 (API level 23) and above. By integrating the SDK, you can monitor your Android application's performance, errors, and user behavior in real-time.

## Integration Steps

### Step 1: Add SDK Dependencies

Add the FlashCat SDK dependencies to your app module's `build.gradle` file:

```groovy
dependencies {
    implementation "cloud.flashcat:fc-sdk-android-core:x.x.x"
    implementation "cloud.flashcat:fc-sdk-android-rum:x.x.x"
}
```

### Step 2: Retrieve Application Information from the Console

In the **RUM Application Management** page of the FlashCat console:

1. Create or select an Android application
2. Obtain the following information:
   - **Application ID**: Application unique identifier
   - **Client Token**: Client access token

### Step 3: Initialize SDK with Application Context

Initialize the FlashCat SDK in the `onCreate()` method of your `Application` class:

```kotlin
import cloud.flashcat.android.Flashcat
import cloud.flashcat.android.FlashcatSite
import cloud.flashcat.android.core.configuration.Configuration
import cloud.flashcat.android.privacy.TrackingConsent

class SampleApplication : Application() {
    override fun onCreate() {
        super.onCreate()

        val clientToken = "<CLIENT_TOKEN>"
        val environmentName = "<ENV_NAME>"
        val appVariantName = "<APP_VARIANT_NAME>"

        val configuration = Configuration.Builder(
            clientToken = clientToken,
            env = environmentName,
            variant = appVariantName
        )
            .useSite(FlashcatSite.US1)
            .build()

        Flashcat.initialize(this, configuration, TrackingConsent.GRANTED)
    }
}
```

```java
import cloud.flashcat.android.Flashcat;
import cloud.flashcat.android.FlashcatSite;
import cloud.flashcat.android.core.configuration.Configuration;
import cloud.flashcat.android.privacy.TrackingConsent;

public class SampleApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();

        String clientToken = "<CLIENT_TOKEN>";
        String environmentName = "<ENV_NAME>";
        String appVariantName = "<APP_VARIANT_NAME>";

        Configuration configuration = new Configuration.Builder(clientToken, environmentName, appVariantName)
                .build();

        Flashcat.initialize(this, configuration, TrackingConsent.GRANTED);
    }
}
```

During initialization, you need to set the environment name (`environmentName`) and app variant name (`appVariantName`). The `appVariantName` specifies which application variant generates the data. For more configuration options, see [Initialization Parameters](#initialization-parameters).

### Step 4: Enable RUM Features and Start Sending Data

Configure and enable the RUM features of the Android SDK:

```kotlin
import cloud.flashcat.android.rum.Rum
import cloud.flashcat.android.rum.RumConfiguration
import cloud.flashcat.android.rum.tracking.ActivityViewTrackingStrategy

val rumConfig = RumConfiguration.Builder(applicationId)
    .trackUserInteractions()
    .trackLongTasks(durationThreshold)
    .useViewTrackingStrategy(ActivityViewTrackingStrategy(true))
    .build()
Rum.enable(rumConfig)
```

```java
import cloud.flashcat.android.rum.Rum;
import cloud.flashcat.android.rum.RumConfiguration;
import cloud.flashcat.android.rum.tracking.ActivityViewTrackingStrategy;

RumConfiguration rumConfig = new RumConfiguration.Builder(applicationId)
    .trackUserInteractions()
    .trackLongTasks(durationThreshold)
    .useViewTrackingStrategy(new ActivityViewTrackingStrategy(true))
    .build();
Rum.enable(rumConfig);
```

### Step 5: Initialize Interceptors to Track Network Events

To initialize interceptors for tracking network events:

1. **Enable Trace Functionality**: Add and enable the Trace feature
2. **Add Dependencies**: Add the `fc-sdk-android-okhttp` library dependency to your module-level `build.gradle` file:

```groovy
dependencies {
    implementation "cloud.flashcat:fc-sdk-android-okhttp:x.x.x"
}
```

3. **Add Interceptor**: Configure the interceptor provided by FlashCat to track OkHttp requests:

```kotlin
import cloud.flashcat.android.okhttp.FlashcatInterceptor
import cloud.flashcat.android.okhttp.trace.TracingHeaderType

val tracedHostsWithHeaderType = mapOf(
    "example.com" to setOf(
        TracingHeaderType.FLASHCAT,
        TracingHeaderType.TRACECONTEXT
    ),
    "api.example.com" to setOf(
        TracingHeaderType.FLASHCAT,
        TracingHeaderType.TRACECONTEXT
    )
)

val okHttpClient = OkHttpClient.Builder()
    .addInterceptor(FlashcatInterceptor.Builder(tracedHostsWithHeaderType).build())
    .build()
```

```java
import cloud.flashcat.android.okhttp.FlashcatInterceptor;
import cloud.flashcat.android.okhttp.trace.TracingHeaderType;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

Map<String, Set<TracingHeaderType>> tracedHostsWithHeaderType = new HashMap<>();
Set<TracingHeaderType> headerTypes = new HashSet<>();
headerTypes.add(TracingHeaderType.FLASHCAT);
headerTypes.add(TracingHeaderType.TRACECONTEXT);
tracedHostsWithHeaderType.put("example.com", headerTypes);
tracedHostsWithHeaderType.put("api.example.com", headerTypes);

OkHttpClient okHttpClient = new OkHttpClient.Builder()
    .addInterceptor(new FlashcatInterceptor.Builder(tracedHostsWithHeaderType).build())
    .build();
```

4. **Automatically Create Resources and Spans**: When using `FlashcatInterceptor` as an interceptor, every request handled by OkHttpClient is automatically recorded as a resource, with related information (URL, method, status code, error) automatically populated. **Note**: Only network requests initiated when a view is active will be tracked. To track requests when the app is in the background, see [Track Background Events](#track-background-events).

5. **Track Network Redirects or Retries**: To monitor network redirects or retries, you can use `FlashcatInterceptor` as a network interceptor:

```kotlin
val okHttpClient = OkHttpClient.Builder()
    .addNetworkInterceptor(FlashcatInterceptor.Builder(tracedHostsWithHeaderType).build())
    .build()
```

```java
OkHttpClient okHttpClient = new OkHttpClient.Builder()
    .addNetworkInterceptor(new FlashcatInterceptor.Builder(tracedHostsWithHeaderType).build())
    .build();
```

**Note**:

- If using multiple interceptors, add `FlashcatInterceptor` as the first interceptor

You can also add an `EventListener` to your `OkHttpClient` to automatically track resource timing for third-party providers and network requests.

#### Filter Specific Errors

To filter specific errors reported by `FlashcatInterceptor`, configure a custom `EventMapper` in the `RumConfiguration`:

```kotlin
val rumConfig = RumConfiguration.Builder(applicationId)
    .setErrorEventMapper { errorEvent ->
        if (errorEvent.shouldBeDiscarded()) {
            null
        } else {
            errorEvent
        }
    }
    .build()
```

```java
RumConfiguration rumConfig = new RumConfiguration.Builder(applicationId)
    .setErrorEventMapper(errorEvent -> {
        if (errorEvent.shouldBeDiscarded()) {
            return null;
        } else {
            return errorEvent;
        }
    })
    .build();
```

## Track Background Events

You can track events that occur when the application is running in the background (such as crashes and network requests).

Add the following code during configuration:

```kotlin
val rumConfig = RumConfiguration.Builder(applicationId)
    // ...
    .trackBackgroundEvents(true)
    .build()
```

```java
RumConfiguration rumConfig = new RumConfiguration.Builder(applicationId)
    // ...
    .trackBackgroundEvents(true)
    .build();
```

**Note**: Tracking background events may generate additional sessions, which could affect billing. If you have questions, please contact the FlashCat support team.

## Send Data When Device is Offline

The Android SDK ensures data availability when the user's device is offline. In cases of weak network signals or low device battery, all events are first stored in batches on the local device.

Each batch follows the data intake specification. Batches are sent as soon as the network becomes available and the battery is sufficient, ensuring the FlashCat SDK doesn't affect the end-user experience. If the network is unavailable while the app is running in the foreground, or if data upload fails, the batch is retained until it is successfully sent.

This means that even if users open your app while offline, no data is lost. To ensure the SDK doesn't use too much disk space, old data on disk is automatically discarded.

### Track Local Resource Access

You can track access to assets resources using the `getAssetAsRumResource` extension method:

```kotlin
val inputStream = context.getAssetAsRumResource(fileName)
```

Track usage of raw resources using the `getRawResAsRumResource` extension method:

```kotlin
val inputStream = context.getRawResAsRumResource(id)
```

## WebView Integration

If your Android application includes WebView, you can enable WebView tracking in the following way:

### Add WebView Dependencies

```groovy
dependencies {
    implementation "cloud.flashcat:fc-sdk-android-webview:x.x.x"
}
```

### Enable WebView Tracking

Enable WebView tracking in your Activity or Fragment:

```kotlin
import cloud.flashcat.android.webview.WebViewTracking

// Enable tracking for the specified WebView
WebViewTracking.enable(webView, listOf("example.com", "*.example.com"))
```

**Parameter Description:**

- `webView`: The WebView instance to track
- `allowedHosts`: List of allowed domains for tracking, supports wildcards

This way, web pages in your WebView can be associated with native app RUM data.

## Verify Integration

After integration is complete, you can verify successful integration through the following steps:

1. **Check Logcat Logs**: Search for the `FlashCat` keyword in Android Studio's Logcat to view SDK initialization and data reporting logs
2. **Access Console**: Log in to the FlashCat console and navigate to the corresponding RUM application to check if data is being reported
3. **Trigger Test Events**:
   - Open different pages of the app to verify page view events
   - Perform user operations (clicks, swipes, etc.) to verify interaction events
   - Trigger network requests to verify resource loading events
4. **Check Data Reporting Address**: Check Logcat for network requests to the data reporting endpoint

## Obfuscation Configuration

If your application has code obfuscation enabled (ProGuard/R8), add the following rules to your `proguard-rules.pro` file:

```proguard
# FlashCat SDK
-keep class cloud.flashcat.android.** { *; }
-dontwarn cloud.flashcat.android.**
```

## Further Reading

- [RUM Application Management](https://docs.flashcat.cloud/en/flashduty/rum/application-management): Learn how to create and manage RUM applications
- [Android SDK Advanced Configuration](https://docs.flashcat.cloud/en/flashduty/rum/android-advanced-configuration): Learn how to configure SDK advanced features
- [RUM Analysis Dashboard](https://docs.flashcat.cloud/en/flashduty/rum/analysis-dashboard): View and analyze RUM data
