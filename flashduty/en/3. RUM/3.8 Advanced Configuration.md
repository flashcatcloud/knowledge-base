---
title: "RUM Advanced Configuration"
description: "Learn about advanced configuration options for FlashCat Real User Monitoring (RUM) to customize data collection and optimize performance."
date: "2024-05-09T10:00:00+08:00"
url: "https://docs.flashcat.cloud/en/flashduty/rum/advanced-configuration"
---

## Overview
---

This guide covers advanced configuration options for FlashCat RUM that allow you to customize data collection, optimize performance, and integrate with other systems. These options give you fine-grained control over how RUM works in your application.

## SDK Configuration Options
---

The FlashCat RUM SDK provides numerous configuration options that you can set during initialization:

```javascript
RumBrowser.init({
  applicationId: 'YOUR_APPLICATION_ID',
  clientToken: 'YOUR_CLIENT_TOKEN',
  site: 'flashcat.cloud',
  service: 'my-web-app',
  env: 'production',
  version: '1.0.0',
  
  // Advanced options below
  sampleRate: 100,
  replaySampleRate: 20,
  trackUserInteractions: true,
  trackResources: true,
  trackLongTasks: true,
  trackErrors: true,
  defaultPrivacyLevel: 'mask-user-input',
  actionNameAttribute: 'data-action-name',
  allowedTracingOrigins: ['https://api.example.com'],
  excludedActivityUrls: ['/health', '/status'],
  proxyUrl: 'https://proxy.example.com/rum',
  silentMultipleInit: false,
  trackingConsent: 'granted',
  enableExperimentalFeatures: [],
  maxErrorsPerMinute: 100,
  maxActionsPerMinute: 100
});
```

### Core Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `applicationId` | string | - | Your RUM application ID (required) |
| `clientToken` | string | - | Your RUM client token (required) |
| `site` | string | 'flashcat.cloud' | The FlashCat site to send data to |
| `service` | string | - | The name of your service or application |
| `env` | string | 'production' | The environment (e.g., 'production', 'staging', 'development') |
| `version` | string | - | The version of your application |

### Data Collection Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `trackUserInteractions` | boolean | true | Whether to track user interactions (clicks, etc.) |
| `trackResources` | boolean | true | Whether to track resource loading (images, scripts, etc.) |
| `trackLongTasks` | boolean | true | Whether to track long tasks (JavaScript execution > 50ms) |
| `trackErrors` | boolean | true | Whether to track JavaScript errors |
| `trackViewsManually` | boolean | false | Whether to track views manually instead of automatically |
| `trackSessionAcrossSubdomains` | boolean | false | Whether to track the same session across subdomains |
| `trackBackgroundTasks` | boolean | false | Whether to track tasks that occur when the page is in the background |

### Sampling Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `sampleRate` | number | 100 | Percentage of sessions to track (0-100) |
| `replaySampleRate` | number | 100 | Percentage of tracked sessions to record for replay (0-100) |
| `errorSampleRate` | number | 100 | Percentage of errors to track (0-100) |
| `resourceSampleRate` | number | 100 | Percentage of resources to track (0-100) |
| `actionSampleRate` | number | 100 | Percentage of actions to track (0-100) |

### Privacy Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `defaultPrivacyLevel` | string | 'mask-user-input' | Privacy level for collected data ('allow', 'mask', 'mask-user-input') |
| `trackingConsent` | string | 'granted' | User consent status ('pending', 'granted', 'not-granted') |
| `maskAllText` | boolean | false | Whether to mask all text content in session replays |
| `maskAllInputs` | boolean | true | Whether to mask all input values in session replays |
| `maskTextSelector` | string | - | CSS selector for elements whose text should be masked |
| `unmaskTextSelector` | string | - | CSS selector for elements whose text should not be masked |
| `maskInputSelector` | string | - | CSS selector for input elements that should be masked |
| `unmaskInputSelector` | string | - | CSS selector for input elements that should not be masked |

### Performance Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `maxErrorsPerMinute` | number | 100 | Maximum number of errors to track per minute |
| `maxActionsPerMinute` | number | 100 | Maximum number of actions to track per minute |
| `maxResourcesPerMinute` | number | 1000 | Maximum number of resources to track per minute |
| `maxSessionReplayTimePerMinute` | number | 30 | Maximum seconds of session replay to record per minute |
| `flushTimeout` | number | 30000 | Time in milliseconds to wait before flushing the data queue |
| `batchSize` | number | 50 | Maximum number of events to include in a single batch |
| `maxBatchSize` | number | 100 | Maximum size in KB of a single batch |
| `maxQueueSize` | number | 500 | Maximum number of events to queue before dropping |

### Integration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `allowedTracingOrigins` | string[] | [] | Origins for which distributed tracing is enabled |
| `tracingSampleRate` | number | 100 | Percentage of traced requests to sample (0-100) |
| `proxyUrl` | string | - | URL to proxy RUM data through instead of sending directly to FlashCat |
| `beforeSend` | function | - | Function to modify or filter events before they are sent |
| `silentMultipleInit` | boolean | false | Whether to silence warnings about multiple initializations |

## User Identification
---

FlashCat RUM allows you to identify users to better understand their experience:

```javascript
// Set user information
RumBrowser.setUser({
  id: '12345',
  name: 'John Doe',
  email: 'john.doe@example.com',
  // Add custom attributes
  plan: 'premium',
  subscriptionDate: '2023-01-15'
});
```

### User Privacy

When setting user information, consider privacy implications:

1. **Anonymize Sensitive Data**: Use hashed or anonymized identifiers when possible
2. **Limit Personal Information**: Only include necessary user attributes
3. **Respect User Consent**: Only set user information when consent is granted

```javascript
// Check consent before setting user information
if (userHasConsented) {
  RumBrowser.setUser({
    id: hashUserId('12345'), // Use a hashing function
    // Avoid including name, email, or other PII
    plan: 'premium'
  });
}
```

## Custom Attributes
---

You can add custom attributes to RUM events to provide additional context:

```javascript
// Add global attributes that apply to all events
RumBrowser.addRumGlobalContext('business', {
  shopId: '123',
  region: 'EMEA',
  storeType: 'flagship'
});

// Add view-specific attributes
RumBrowser.addRumGlobalContext('page', {
  category: 'product',
  template: 'standard',
  isResponsive: true
});
```

### Removing Custom Attributes

You can also remove previously added custom attributes:

```javascript
// Remove a specific context
RumBrowser.removeRumGlobalContext('business');
```

## Session Management
---

FlashCat RUM provides options for managing user sessions:

### Starting a New Session

You can manually start a new session:

```javascript
// Start a new session
RumBrowser.startSessionReplayRecording();
```

### Ending a Session

You can manually end the current session:

```javascript
// End the current session
RumBrowser.stopSessionReplayRecording();
```

### Session Timeout Configuration

Configure session timeout behavior:

```javascript
RumBrowser.init({
  // ... other configuration options
  sessionReplayConfig: {
    inactivityTimeoutInMs: 900000, // 15 minutes (default)
    maxSessionDurationInMs: 14400000 // 4 hours (default)
  }
});
```

## Resource Filtering
---

You can configure which resources are tracked by RUM:

```javascript
RumBrowser.init({
  // ... other configuration options
  resourceSampleRate: 100,
  excludedActivityUrls: [
    '/health',
    '/status',
    '/analytics',
    'https://analytics.example.com'
  ],
  resourceUrlFilter: function(url) {
    // Return true to track the resource, false to ignore it
    return !url.includes('non-critical');
  }
});
```

## Error Filtering
---

You can configure which errors are tracked by RUM:

```javascript
RumBrowser.init({
  // ... other configuration options
  errorSampleRate: 100,
  maxErrorsPerMinute: 100,
  beforeSend: function(event) {
    if (event.type === 'error') {
      // Ignore certain types of errors
      if (event.error && event.error.message && event.error.message.includes('Script error')) {
        return false; // Don't send this error
      }
      
      // Modify error information
      if (event.error && event.error.stack) {
        event.error.stack = event.error.stack.split('\n').slice(0, 5).join('\n');
      }
    }
    return event; // Send the modified event
  }
});
```

## Action Filtering
---

You can configure which user actions are tracked by RUM:

```javascript
RumBrowser.init({
  // ... other configuration options
  actionSampleRate: 100,
  actionNameAttribute: 'data-action-name',
  beforeSend: function(event) {
    if (event.type === 'action') {
      // Ignore certain types of actions
      if (event.action && event.action.type === 'click' && 
          event.action.target && event.action.target.includes('non-critical')) {
        return false; // Don't send this action
      }
      
      // Modify action information
      if (event.action) {
        event.action.name = `[${event.view.url}] ${event.action.name}`;
      }
    }
    return event; // Send the modified event
  }
});
```

## Session Replay Configuration
---

FlashCat RUM provides detailed configuration options for session replay:

```javascript
RumBrowser.init({
  // ... other configuration options
  replaySampleRate: 20, // Record 20% of sessions
  sessionReplayConfig: {
    blockClass: 'privacy', // CSS class for elements to exclude from recording
    blockSelector: '.private, .sensitive', // CSS selector for elements to exclude
    ignoreClass: 'ignore-replay', // CSS class for elements to ignore interactions with
    maskAllInputs: true, // Mask all input values
    maskTextSelector: '.username, .email', // CSS selector for text to mask
    unmaskTextSelector: '.public', // CSS selector for text to not mask
    maskInputSelector: 'input[type="password"], input.sensitive', // CSS selector for inputs to mask
    unmaskInputSelector: 'input.public', // CSS selector for inputs to not mask
    recordCanvas: false, // Whether to record canvas elements
    recordNetwork: true, // Whether to record network requests
    recordConsole: true, // Whether to record console logs
    recordPerformance: true, // Whether to record performance metrics
    maxReplayDuration: 3600, // Maximum duration in seconds to record
    sampleRate: 10 // Sample rate for recording mouse movements (1 = every frame, 10 = every 10th frame)
  }
});
```

## Distributed Tracing
---

FlashCat RUM supports distributed tracing to connect frontend and backend performance data:

```javascript
RumBrowser.init({
  // ... other configuration options
  allowedTracingOrigins: [
    'https://api.example.com',
    /^https:\/\/.*\.example\.com$/
  ],
  tracingSampleRate: 100,
  traceContextInjection: true
});
```

This configuration enables:

1. **Frontend-Backend Correlation**: Connect RUM data with backend traces
2. **End-to-End Visibility**: Track requests from browser to backend services
3. **Performance Analysis**: Identify whether performance issues are in the frontend or backend

## Single-Page Application (SPA) Configuration
---

For SPAs, you can configure RUM to properly track views and route changes:

```javascript
RumBrowser.init({
  // ... other configuration options
  trackViewsManually: true, // Disable automatic view tracking
  trackSessionAcrossSubdomains: true, // Track the same session across subdomains
  trackBackgroundTasks: true // Track tasks that occur when the page is in the background
});

// Then manually track views when routes change
function onRouteChange(routeName, url) {
  RumBrowser.startView({
    name: routeName,
    url: url
  });
}
```

### Framework-Specific Integration

For popular frameworks, you can use specific integration patterns:

#### React Router

```javascript
import { useEffect } from 'react';
import { useLocation } from 'react-router-dom';

function RumRouteTracker() {
  const location = useLocation();

  useEffect(() => {
    RumBrowser.startView({
      name: location.pathname,
      url: location.pathname + location.search
    });
  }, [location]);

  return null;
}

// Add this component to your app
function App() {
  return (
    <Router>
      <RumRouteTracker />
      {/* Rest of your app */}
    </Router>
  );
}
```

#### Vue Router

```javascript
// In your router configuration
router.afterEach((to) => {
  RumBrowser.startView({
    name: to.name || to.path,
    url: to.path + to.fullPath.substring(to.path.length)
  });
});
```

#### Angular Router

```typescript
import { Router, NavigationEnd } from '@angular/router';
import { filter } from 'rxjs/operators';

@Injectable()
export class RumRouteTracker {
  constructor(private router: Router) {
    this.router.events.pipe(
      filter(event => event instanceof NavigationEnd)
    ).subscribe((event: NavigationEnd) => {
      RumBrowser.startView({
        name: event.url,
        url: event.url
      });
    });
  }
}
```

## Performance Optimization
---

To optimize the performance impact of the RUM SDK:

```javascript
RumBrowser.init({
  // ... other configuration options
  
  // Reduce data collection
  sampleRate: 20, // Track only 20% of sessions
  replaySampleRate: 5, // Record only 5% of tracked sessions
  
  // Limit resource tracking
  resourceSampleRate: 50, // Track only 50% of resources
  excludedActivityUrls: [
    '/non-critical',
    '/analytics',
    '/tracking'
  ],
  
  // Optimize batch sending
  flushTimeout: 60000, // Send data every 60 seconds instead of 30
  batchSize: 100, // Increase batch size to reduce number of requests
  
  // Limit data volume
  maxErrorsPerMinute: 50,
  maxActionsPerMinute: 50,
  maxResourcesPerMinute: 500,
  
  // Optimize session replay
  sessionReplayConfig: {
    sampleRate: 20, // Record only every 20th frame for mouse movements
    recordCanvas: false,
    recordConsole: false
  }
});
```

## Custom Event Tracking
---

You can track custom events that are specific to your application:

```javascript
// Track a custom event
RumBrowser.addCustomEvent('business_event', {
  type: 'purchase',
  productId: '12345',
  amount: 99.99,
  currency: 'USD'
});
```

Custom events can be used to track business metrics, user milestones, or any other events that are important for your application.

## Integration with Analytics
---

FlashCat RUM can be integrated with analytics tools:

```javascript
// Google Analytics integration
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

// Track RUM views in Google Analytics
RumBrowser.onViewCreated(function(view) {
  gtag('event', 'page_view', {
    page_title: view.name,
    page_location: view.url,
    rum_view_id: view.id
  });
});

// Track RUM errors in Google Analytics
RumBrowser.onError(function(error) {
  gtag('event', 'exception', {
    description: error.message,
    fatal: true,
    rum_error_id: error.id
  });
});
```

## Conclusion
---

FlashCat RUM provides extensive configuration options that allow you to customize data collection, optimize performance, and integrate with other systems. By leveraging these advanced options, you can ensure that RUM provides valuable insights while minimizing the impact on your application's performance and respecting user privacy.

For more information or assistance with advanced configuration, contact FlashCat support at support@flashcat.cloud.
