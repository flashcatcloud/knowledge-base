---
title: "了解告警降噪"
description: "深入理解 Flashduty 的告警降噪模型与原理"
date: "2025-05-19T10:00:00+08:00"
url: "https://docs.flashcat.cloud/zh/flashduty/what-is-noise-reduction"
---

在现代化监控系统中，单一故障往往会引发海量告警（告警风暴）。Flashduty 通过多层降噪模型，将数以千计的原始事件收敛为少量的、可行动的“故障”，大幅降低通知频次，提升运维效率。

## 降噪模型
---

### 核心概念

Flashduty 的数据处理链路包含三个层级：

1.  **事件 (Event)**：监控系统上报的原始数据点。例如：Zabbix 每分钟上报一次“CPU > 90%”的检测结果。
2.  **告警 (Alert)**：由同源事件自动去重合并而成。例如：同一台主机在过去 1 小时内上报的 60 次 CPU 异常事件，会被合并为 1 条“CPU 告警”。
3.  **故障 (Incident)**：平台处理的主要对象。由多条相似的告警聚合而成。例如：同一机柜下 10 台主机的“网络不可达”告警，会被聚合为 1 条“机柜断网”故障。

### 处理流程

当监控系统产生告警时，Flashduty 会按以下步骤进行降噪：

1.  **事件接入**：接收监控系统推送的原始数据。
2.  **事件去重**：判断新事件是否属于已存在的活跃告警。如果是，则在已有告警中生成新的事件；否则，生成新告警。
3.  **告警聚合**：判断新告警是否符合 **聚合策略**（如属于同一服务）。如果符合，则将其合入已有的活跃故障；否则，触发新故障。
4.  **分派通知**：系统仅针对新触发的故障（或状态变化）发送通知，被合入的告警不再单独打扰。

![2025-12-09-15-14-06](https://docs-cdn.flashcat.cloud/images/png/542f0e4e0eafbd6034073a0a22627232.png)

## 聚合机制
---

告警聚合是降噪的核心。您可以灵活定义“什么样的告警应该算作同一个故障”。

### 1. 通用配置

*   **聚合窗口**：定义了故障聚合的时间范围。以故障**首次发生时间**为起点，在设定的时间窗口内（如 1 小时），符合规则的后续告警将被聚合。超出窗口的告警将触发新故障。
*   **风暴预警**：当单条故障聚合的告警数量超过设定阈值（如 100 条）时，系统会发送特殊的“风暴预警”通知，提醒您关注严重问题。
*   **严格聚合**：决定是否允许“空值”匹配。开启后，必须标签值完全一致才聚合；关闭后，两个空值也视为匹配。

### 2. 聚合模式

*   **智能聚合 (Smart)**：利用机器学习算法，自动分析告警文本的语义相似度。适用于不想配置复杂规则的场景。
*   **规则聚合 (Rule-based)**：用户明确定义聚合维度（如 `cluster`、`service`）。这是最常用、最可控的模式。

:::tip 配置指南
关于如何在控制台设置这些策略，请参考操作指南：**[配置告警降噪](https://docs.flashcat.cloud/zh/flashduty/noise-reduction-settings)**
:::

## 降噪效果示例
---

假设您设置了按 **告警检查项 (Check)** 进行聚合。系统依次收到以下 5 次事件：

```
故障：cpu idle < 20% / es.nj.03，Critical

  - 告警cpu idle < 20% / es.nj.03：
      - 事件1：es.nj.03，cpu.idle = 10%，Critical
      - 事件2：es.nj.03，cpu.idle = 18%，Warning
      - 事件4：es.nj.03，cpu.idle = 10%，Ok

  - 告警cpu idle < 20% / es.nj.01：
      - 事件3：es.nj.01，cpu.idle = 15%，Warning
  
  - 告警cpu idle < 20% / es.nj.02：
      - 事件5：es.nj.02，cpu.idle = 19%，Warning
```

**最终结果**：
系统仅生成 **1 条故障**（标题为 `cpu idle < 20%`），上述所有事件都会被关联到这个故障下。

我们通过控制台故障详情页，可以看到最终的【故障-告警-事件】关联关系：
*   点击告警标题，您可以查看关联告警的详情，包括告警的时间线和关联事件。
*   点击事件点，您可以查看事件上报的具体内容，包括标签和描述。

![2025-12-09-15-15-23](https://docs-cdn.flashcat.cloud/images/png/d34e839e2d52e5fa91a426dca032d67e.png)

## 常见问题
---

<details>
  <summary>故障的标题是否会随告警合入改变？</summary>
  不会，默认故障的标题与触发该故障的第一条告警完全相同，您可以在任何时候手动修改故障标题，此标题不会随新告警合入发生变化。
</details>

<details>
  <summary>故障的标签是否会随告警合入改变？</summary>
  
  - **手工创建的告警**：不会，其标签列表将永远为空。
  - **自动触发的告警**：有可能。故障的标签默认与触发它的第一条告警保持一致。如果那条“第一告警”的标签随后发生了变化（例如监控系统更新了标签值），故障的标签也会同步更新。
</details>

<details>
  <summary>告警的标签是否会随事件合入改变？</summary>
  会的，告警的标签总是与新合入的事件保持一致。比如，如果您10点钟收到一条告警”CPU idle 偏低“，触发值为10%，随着告警合入更多事件，该触发值标签可能会动态变化。但如果新收到的事件，是一条恢复事件，告警将保持已存在的标签不变，并增加之前不存在的标签。我们的原则是，告警展示的标签尽可能保持触发时的样子。
</details>

<details>
  <summary>故障合入的告警数量是否存在上限？</summary>
  存在，我们设置了单个故障最多聚合1000条告警，这主要是为了降低控制台页面的渲染时间。但同时，Flashduty是一个高性能的事件处理系统，后台存在大量并发逻辑，因此当您看到故障聚合超过1000条告警时，这是可能出现的正常现象。
</details>

<details>
  <summary>告警合入的事件数量是否存在上限？</summary>
  不存在。但一个告警聚合事件的窗口最大为24小时。这意味着，如果一个告警触发24小时后还没有恢复，未来也不会合入新的事件。如果Flashduty收到新的事件，会产生新的告警。
</details>

<details>
  <summary>为什么我推送的事件数量和告警关联的事件数量对不上？</summary>
  事件到告警的合并也是一个降噪过程。如果Flashduty认为新上报的事件和告警变化不大（比如状态、严重程度、描述等都没有变化），Flashduty会直接丢弃新上报的事件，并使用新事件的标签来覆盖已有的标签。
</details>
