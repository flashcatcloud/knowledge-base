---
title: "配置路由规则"
description: "将集成中心的告警自动分发到正确的协作空间"
date: "2024-05-14T10:00:00+08:00"
url: "https://docs.flashcat.cloud/zh/flashduty/alert-routings"
---

在 **共享集成** 模式下，集成中心接收到的所有告警就像进入了一个繁忙的“交通枢纽”。**路由规则** 就是交通指挥官，负责根据告警的内容（如标签、标题），将其精准地分发到对应的 **协作空间** 进行处理。

如果未配置路由规则，或告警未匹配任何规则，它可能会被丢弃或进入默认空间，导致处理延误。

## 视频介绍
---
<Video width="200" style="width: 140px;" src="https://download.flashcat.cloud/flashduty/video/routings.mp4"></Video>

## 配置逻辑
---
进入 **集成中心 => 告警事件**，点击某个集成的名称，切换到 **路由** 页签即可开始配置。

路由规则的执行逻辑是从上到下依次匹配，类似于防火墙规则。

### 1. 匹配条件
决定了“什么样的告警”会命中这条规则。
*   **多条件组合**：支持 AND（所有条件满足）和 OR（任一条件满足）逻辑。
*   **运算符**：支持 精确匹配（=）、正则匹配（Regex）、包含（Contains）、不包含（Not Contains）等。
*   **常用维度**：通常使用 `labels`（标签）作为判断依据，例如 `labels.service = payment`。

### 2. 执行动作
当告警命中规则后，系统会执行以下动作：
*   **投递到协作空间**：选择一个或多个目标空间。告警将会在这些空间中生成故障。
*   **流程控制**：
    *   **继续匹配 (Continue)**：(默认) 告警投递后，继续向下检查下一条路由规则。适用于“一警多发”场景（例如：既发给 SRE 团队，又发给业务研发团队）。
    *   **停止匹配 (Stop)**：告警投递后，立即终止流程，不再检查后续规则。适用于“精准分派”场景（例如：明确是 DBA 的问题，就没必要再问其他人了）。

### 3. 兜底策略 (默认路由)
位于规则列表的最底部，不可删除。
*   **作用**：当告警没有匹配上方任何一条规则时，它会被这条规则捕获。
*   **建议**：建议设置一个“公共待办”或“SRE 值班”空间作为兜底，防止告警因为配置疏漏而丢失。

<img src="https://fcpub-1301667576.cos.ap-nanjing.myqcloud.com/flashduty/doc/zh/fd/route-1.png"  width="800" />

## 配置技巧
---
*   **调整顺序**：由于规则是从上到下执行的，建议将 **最具体、最精准** 的规则放在前面，将 **宽泛** 的规则放在后面。可以通过拖拽或“插入路由”来调整顺序。
*   **版本回滚**：路由规则支持“编辑历史”。如果您不小心改乱了配置，可以一键恢复到之前的版本。

## 配置示例
---

### 场景：按业务组分发
**需求**：监控系统上报的告警中包含 `group_name` 标签，需要根据该标签将告警分发到对应的业务协作空间。

**配置**：
*   **条件**：`Labels.group_name` **等于** `payment-service`
*   **动作**：投递到 **支付业务空间**，并 **停止匹配**。

<img src="https://fcpub-1301667576.cos.ap-nanjing.myqcloud.com/flashduty/doc/luyou-2.png"  width="800" />

## 常见问题
---
<details>
<summary>路由规则没有生效？</summary>
请查看告警事件是否跟规则匹配以及规则配置是否正确。
</details>

<details>
<summary>多个路由规则相同时，投递到相同协作空间时会怎么处理？</summary>
会向每个协作空间生成相应的故障，建议在同一规则中选择多个协作空间。
</details>

<details>
<summary>配置路由规则后收不到告警了？</summary>
请确认上报的告警事件是否可以命中配置的路由规则，建议配置一个默认兜底路由来接收无法匹配的告警事件。
</details>

<details>
<summary>当路由规则流程控制选择的是停止时，是否会匹配默认路由？</summary>
会匹配，默认路由是兜底路由，不受流程控制的限制。
</details>
