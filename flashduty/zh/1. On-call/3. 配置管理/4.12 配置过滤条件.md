---
title: "配置过滤条件"
description: "掌握条件匹配语法，实现精细化的告警过滤与路由"
date: "2024-06-17T10:00:00+08:00"
url: "https://docs.flashcat.cloud/zh/flashduty/how-to-filter"
---

在 Flashduty 中，**过滤条件** 就像一把通用的“筛子”，广泛应用于 **分派策略**、**静默规则**、**抑制规则**、**路由规则** 等核心功能。

掌握过滤条件的配置方法，是实现精细化告警管理的前提。

## 应用场景
---
只要涉及到“筛选特定告警”的场景，都需要用到过滤条件：

1.  **精准分派**：只把 `等级=Critical` 且 `服务=支付` 的故障发给 SRE 团队。
2.  **智能静默**：自动屏蔽 `主机名` 包含 `test-` 的测试环境告警。
3.  **根因抑制**：当 `数据库` 故障时，抑制所有下游的 `连接超时` 告警。
4.  **标签增强**：仅对 `来源=Prometheus` 的告警执行标签提取规则。

## 配置逻辑
---
Flashduty 的条件判断逻辑采用两层结构：**条件组** 和 **原子条件**。

1.  **组内“且” (AND)**：同一个条件组内的多个条件，必须**全部满足**。
2.  **组间“或” (OR)**：多个条件组之间，只要**任一组满足**，整体即视为匹配。

### 原子条件结构
每个原子条件包含三个部分：
*   **字段**：如 `severity`（严重程度）、`labels.host`（主机标签）。
*   **运算符**：
    *   **匹配**：目标值列表中的**任意一个**满足条件即可。
    *   **不匹配**：目标值列表中的**所有值**均不满足条件。
*   **目标值**：支持精确值、正则、通配符等多种格式（详见下文）。

![2025-12-09-10-39-03](https://docs-cdn.flashcat.cloud/images/png/f119c0afb7a9a0dec3028576b365580a.png)

**示例解读**：
上图的配置逻辑翻译为自然语言是：
> （严重程度是 Critical 或 Warning **且** check 标签等于“Binlog同步延迟”）
> **或者**
> （check 标签包含 cpu/io/disk **且** value 标签数值大于 90）

## 高级匹配语法
---
目标值（Value）不仅仅支持纯文本，还支持以下高级语法：

### 1. 正则表达式
当目标值以 `/` 开头和结尾时，系统会自动将其识别为正则模式。
*   **格式**：`/正则表达式/`
*   **示例**：`/^db-.*-master$/`（匹配以 db- 开头，-master 结尾的主机名）
*   **规范**：采用 **RE2** 语法标准。

### 2. 通配符
当目标值包含 `*` 或 `?` 且没有 `/` 包裹时，识别为通配模式。
*   **`*`**：匹配任意长度的字符（包括空字符）。
*   **`?`**：匹配单个任意字符。
*   **示例**：`test-*`（匹配 test-01, test-env 等）。

:::tip 存在性判断
*   **存在**：设置字段 **匹配** `*`。表示要求该标签必须存在且不为空。
*   **不存在**：设置字段 **不匹配** `*`。表示要求该标签必须不存在或为空。
:::

### 3. IP 网段 (CIDR)
当目标值以 `cidr:` 开头时，识别为 IP 网段匹配。
*   **格式**：`cidr:网段地址`
*   **示例**：`cidr:192.168.0.0/16`（匹配该网段内的所有 IP）

### 4. 数值比较
当目标值以 `num:` 开头时，识别为数值比较。
*   **格式**：`num:操作符:数值`
*   **操作符**：
    *   `gt`：大于 (>)
    *   `ge`：大于等于 (>=)
    *   `lt`：小于 (<)
    *   `le`：小于等于 (<=)
*   **示例**：`num:ge:90`（匹配数值大于等于 90 的告警）

:::caution 限制说明
**IP 网段** 和 **数值比较** 暂不支持在“故障列表/告警列表的搜索框”以及“抑制规则的活跃故障筛选”中使用。
:::

### 5. 精确匹配
如果不符合上述任何特殊格式，则视为精确字符串匹配。只有完全相等才算命中。

## 常见问题
---

<details>
  <summary>为什么下拉列表中找不到我想选的标签？</summary>
  为了系统性能，下拉列表仅展示过去 24 小时内活跃的 TOP 500 标签。如果没有找到您需要的标签，**直接手动输入** 即可，系统依然能够正确识别和匹配。
</details>

<details>
  <summary>我的正则在其他地方能用，为什么在这里不生效？</summary>
  Flashduty 使用的是 **RE2** 正则引擎，它不支持某些 Perl 高级特性（如回顾断言）。建议您使用 [RE2 Playground](https://regex101.com) 进行在线验证。
</details>
