---
title: "告警处理 Pipeline"
description: "在告警接入源头进行数据清洗、格式化与预处理"
date: "2024-06-18T10:00:00+08:00"
url: "https://docs.flashcat.cloud/zh/flashduty/alert-pipelines"
---

不同监控系统（如 Zabbix、Prometheus、阿里云）上报的告警格式千差万别。Flashduty 虽然内置了主流监控系统的默认映射规则，但在面对复杂的企业级运维场景时，您可能需要更灵活的数据处理能力。

**告警处理 Pipeline** 允许您在告警数据进入 Flashduty 的第一时间（集成层），对其进行**清洗**、**转换**和**过滤**。它就像一个数据加工厂，确保流入协作空间的告警是规范、清晰且有价值的。

## 视频介绍
---
<Video width="200" style="width: 140px;" src="https://download.flashcat.cloud/flashduty/video/alert-pipelines.mp4"></Video>

## 工作原理
---
Pipeline 位于 **告警接入** 和 **路由分发** 之间。它的执行逻辑如下：

1.  **链式处理**：您可以配置多个处理规则，系统按照**从上到下**的顺序依次执行。
2.  **输入输出**：上一个规则处理后的结果（如修改了标题），可以作为下一个规则的输入。
3.  **层级定位**：Pipeline 作用于 **集成层**。这意味着规则一旦生效，所有通过该集成接入的告警都会受影响，无论它最终被路由到哪个协作空间。

![2025-12-09-11-10-42](https://docs-cdn.flashcat.cloud/images/png/33c8565bfb741b2007da80e480c61271.png)

## 配置入口
---
进入 **集成中心** => 选择以创建的集成 => **告警处理** 页签。

![2025-12-09-11-12-23](https://docs-cdn.flashcat.cloud/images/png/5aeb4961d8da924d85bbbca208b36e4f.png)

## 核心功能与场景
---

### 1. 严重程度自定义 
Flashduty 已经为标准集成内置了等级映射（例如将 Zabbix `High` 映射为 `Critical`）。但如果默认规则不满足您的需求，您可以通过 Pipeline 进行覆盖。

*   **场景**：监控系统中的 `Warning` 级别告警，对于核心支付业务来说实际上是致命的，需要升级为 `Critical` 以触发电话通知。
*   **配置**：
    *   **条件**：`labels.service` 等于 `payment` 且 `severity` 等于 `Warning`
    *   **动作**：更新严重程度为 `Critical`

### 2. 信息重写
通过模板语法，将晦涩难懂的机器语言转换为人类可读的业务语言。

#### 重写标题
*   **场景**：原始标题包含大量 ID，缺乏业务含义。
*   **原标题**：`[Problem] CPU Load High on i-12345678`
*   **新标题模板**：`[TPL]{{.Labels.env}}环境 - {{.Labels.service}}服务 CPU 负载告警`
*   **效果**：`生产环境 - 订单服务 CPU 负载告警`

#### 重写描述
*   **场景**：在描述中自动追加 Runbook 链接或 dashboard 地址，辅助快速排障。
*   **动作**：更新告警描述
*   **追加内容**：`Grafana看板: https://grafana.corp.com/d/cpu?var-host={{.Labels.host}}`


### 3. 告警丢弃
在数据入库前直接丢弃，不保留任何记录。这与协作空间的“排除规则”类似，但生效位置更靠前。

*   **场景**：开发环境的频繁重启告警，或者某些已知的无害报错（如 "NTP offset"）。
*   **优势**：直接在源头清洗，减少对后续路由和存储资源的占用。

### 4. 告警抑制
Pipeline 中的抑制功能与协作空间的抑制规则**完全一致**，都支持基于源故障、目标故障和关联条件的依赖抑制。

*   **区别**：
    *   **生效层级**：Pipeline 抑制在集成层生效，协作空间抑制在空间层生效。
    *   **适用场景**：Pipeline 适合处理**全局性**的抑制逻辑。例如，整个机房断网了，该机房下的所有告警（无论属于哪个业务线）都应该被抑制。此时在集成层配置一条规则，比在几十个协作空间里分别配置要高效得多。

## 引用语法说明
---
在重写标题或描述时，可以使用 Go Template 语法引用告警内部变量。合理使用变量引用，可以让您的告警通知更具动态性和信息量。

| 变量 | 说明 | 示例 |
| :--- | :--- | :--- |
| `[TPL]{{.Labels.xxx}}` | 引用特定标签 | `[TPL]{{.Labels.host}}` |
| `[TPL]{{.Title}}` | 引用当前标题 | `[TPL][转发] {{.Title}}` |
| `[TPL]{{.Description}}` | 引用当前描述 | `[TPL]详情: {{.Description}}` |
| `[TPL]{{.Severity}}` | 引用当前等级 | `[TPL]当前级别: {{.Severity}}` |

:::tip 最佳实践
在配置 Pipeline 之前，建议先观察一段时间的原始告警数据，明确哪些字段（Labels）是稳定的，哪些是需要清洗的。
:::
