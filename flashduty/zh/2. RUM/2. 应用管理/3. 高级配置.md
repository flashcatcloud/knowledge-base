---
title: "RUM SDK é«˜çº§é…ç½®"
description: "æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•é…ç½® FlashCat RUM SDK çš„é«˜çº§åŠŸèƒ½ã€‚"
date: "2024-05-09T10:00:00+08:00"
url: "https://docs.flashcat.cloud/zh/flashduty/rum/advanced-configuration"
---

## æ¦‚è¿°

FlashDuty çœŸå®ç”¨æˆ·ç›‘æ§ï¼ˆRUMï¼‰æä¾›å¤šç§é«˜çº§é…ç½®é€‰é¡¹ï¼Œå…è®¸æ‚¨æ ¹æ®éœ€æ±‚ä¿®æ”¹æ”¶é›†çš„æ•°æ®å’Œä¸Šä¸‹æ–‡ï¼Œæ”¯æŒä»¥ä¸‹åœºæ™¯ï¼š

- **ä¿æŠ¤æ•æ„Ÿæ•°æ®**ï¼šå±è”½ä¸ªäººèº«ä»½ä¿¡æ¯ç­‰æ•æ„Ÿæ•°æ®ã€‚
- **å…³è”ç”¨æˆ·ä¼šè¯**ï¼šå°†ç”¨æˆ·ä¼šè¯ä¸å†…éƒ¨ç”¨æˆ·æ ‡è¯†å…³è”ï¼Œä¾¿äºæ”¯æŒå’Œé—®é¢˜æ’æŸ¥ã€‚
- **å‡å°‘æ•°æ®é‡**ï¼šé€šè¿‡é‡‡æ ·é™ä½ RUM æ•°æ®æ”¶é›†é‡ï¼Œä¼˜åŒ–æˆæœ¬ã€‚
- **å¢å¼ºä¸Šä¸‹æ–‡**ï¼šä¸ºæ•°æ®æ·»åŠ æ¯”é»˜è®¤å±æ€§æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

ä»¥ä¸‹ç« èŠ‚è¯¦ç»†ä»‹ç»å¦‚ä½•å®ç°è¿™äº›åŠŸèƒ½ã€‚

## è¦†ç›–é»˜è®¤ RUM è§†å›¾åç§°

FlashDuty RUM æµè§ˆå™¨ SDK ä¼šåœ¨ç”¨æˆ·è®¿é—®æ–°é¡µé¢æˆ–å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­ URL æ›´æ”¹æ—¶è‡ªåŠ¨ç”Ÿæˆè§†å›¾äº‹ä»¶ã€‚è§†å›¾åç§°é»˜è®¤ä»å½“å‰é¡µé¢ URL è®¡ç®—ï¼Œå¹¶è‡ªåŠ¨ç§»é™¤å˜é‡ IDï¼ˆåŒ…å«æ•°å­—çš„è·¯å¾„æ®µï¼‰ã€‚ä¾‹å¦‚ï¼Œ`/dashboard/1234` å’Œ `/dashboard/9a` ä¼šè¢«å½’ä¸€åŒ–ä¸º `/dashboard/?`ã€‚

æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® `trackViewsManually` é€‰é¡¹æ‰‹åŠ¨è·Ÿè¸ªè§†å›¾äº‹ä»¶ï¼Œå¹¶ä¸ºè§†å›¾æŒ‡å®šè‡ªå®šä¹‰åç§°ä»¥åŠå…³è”çš„æœåŠ¡å’Œç‰ˆæœ¬ã€‚

### é…ç½®æ‰‹åŠ¨è·Ÿè¸ªè§†å›¾

åœ¨åˆå§‹åŒ– FlashDuty RUM SDK æ—¶ï¼Œè®¾ç½® `trackViewsManually` ä¸º `true`ï¼š

```javascript
import { flashcatRum } from "@flashcatcloud/browser-rum";

flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  trackViewsManually: true,
});
```

å¯ç”¨æ‰‹åŠ¨è·Ÿè¸ªåï¼Œæ‚¨éœ€è¦åœ¨æ¯ä¸ªæ–°é¡µé¢æˆ–è·¯ç”±æ›´æ”¹ï¼ˆå¯¹äºå•é¡µåº”ç”¨ï¼‰æ—¶è°ƒç”¨ `startView` æ–¹æ³•ä»¥å¯åŠ¨è§†å›¾ã€‚RUM æ•°æ®å°†åœ¨è§†å›¾å¯åŠ¨æ—¶å¼€å§‹æ”¶é›†ã€‚æ‚¨å¯ä»¥ä¸ºè§†å›¾åŠå…¶å­äº‹ä»¶æ·»åŠ ä¸Šä¸‹æ–‡ã€‚

#### å‚æ•°è¯´æ˜

- **name**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè§†å›¾åç§°ï¼Œé»˜è®¤ä¸ºé¡µé¢ URL è·¯å¾„ã€‚
- **service**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šæœåŠ¡åç§°ï¼Œé»˜è®¤ä¸ºåˆ›å»º RUM åº”ç”¨æ—¶æŒ‡å®šçš„æœåŠ¡ã€‚
- **version**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šåº”ç”¨ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºåˆ›å»º RUM åº”ç”¨æ—¶æŒ‡å®šçš„ç‰ˆæœ¬ã€‚
- **context**ï¼ˆå¯¹è±¡ï¼‰ï¼šè§†å›¾çš„é™„åŠ ä¸Šä¸‹æ–‡ï¼Œåº”ç”¨äºè§†å›¾åŠå…¶å­äº‹ä»¶ã€‚

### ç¤ºä¾‹ï¼šæ‰‹åŠ¨è·Ÿè¸ªç»“è´¦é¡µé¢è§†å›¾

ä»¥ä¸‹ç¤ºä¾‹åœ¨ RUM åº”ç”¨ä¸­æ‰‹åŠ¨è·Ÿè¸ªç»“è´¦é¡µé¢çš„é¡µé¢è§†å›¾ï¼Œä½¿ç”¨ `checkout` ä½œä¸ºè§†å›¾åç§°ï¼Œå¹¶å…³è” `purchase` æœåŠ¡ï¼Œç‰ˆæœ¬ä¸º `1.2.3`ï¼š

```javascript
flashcatRum.startView({
  name: "checkout",
  service: "purchase",
  version: "1.2.3",
  context: {
    payment: "Done",
  },
});
```

### React è·¯ç”±é›†æˆ

å¯¹äºä½¿ç”¨ React Router v6 çš„åº”ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¦†ç›–é»˜è®¤è§†å›¾åç§°ï¼Œä½¿å…¶ä¸ React åº”ç”¨ä¸­å®šä¹‰çš„è·¯ç”±åç§°ä¸€è‡´ï¼š

1. åœ¨åˆå§‹åŒ–æ—¶è®¾ç½® `trackViewsManually` ä¸º `true`ï¼ˆå¦‚ä¸Šï¼‰ã€‚
2. åœ¨è·¯ç”±æ›´æ”¹æ—¶å¯åŠ¨è§†å›¾ï¼Œä½¿ç”¨ `react-router-dom` çš„ `useLocation` å’Œ `matchRoutes` APIã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```javascript
import { matchRoutes, useLocation } from "react-router-dom";
import { routes } from "path/to/routes";
import { flashcatRum } from "@flashcatcloud/browser-rum";
import { useEffect } from "react";

export default function App() {
  let location = useLocation();

  useEffect(() => {
    const routeMatches = matchRoutes(routes, location.pathname);
    const viewName = routeMatches && computeViewName(routeMatches);
    if (viewName) {
      flashcatRum.startView({ name: viewName });
    }
  }, [location.pathname]);

  // ...
}

// è®¡ç®—è§†å›¾åç§°
function computeViewName(routeMatches) {
  let viewName = "";
  for (let index = 0; index < routeMatches.length; index++) {
    const routeMatch = routeMatches[index];
    const path = routeMatch.route.path;
    if (!path) continue; // è·³è¿‡æ— è·¯å¾„è·¯ç”±

    if (path.startsWith("/")) {
      viewName = path; // å¤„ç†ç»å¯¹å­è·¯ç”±è·¯å¾„
    } else {
      viewName += viewName.endsWith("/") ? path : `/${path}`; // å¤„ç†è·¯å¾„æ‹¼æ¥
    }
  }

  return viewName || "/";
}
```

### è®¾ç½®è§†å›¾åç§°

ä½¿ç”¨ `setViewName` æ–¹æ³•æ›´æ–°å½“å‰è§†å›¾çš„åç§°ï¼Œè€Œæ— éœ€å¯åŠ¨æ–°è§†å›¾ã€‚æ›´æ”¹åçš„è§†å›¾åç§°ä¼šå½±å“è§†å›¾åŠå…¶å­äº‹ä»¶ï¼ˆä»è°ƒç”¨æ—¶åˆ»èµ·ï¼‰ã€‚

```javascript
flashcatRum.setViewName("Checkout");
```

## ä¸°å¯Œå’Œæ§åˆ¶ RUM æ•°æ®

FlashDuty RUM æµè§ˆå™¨ SDK ä¼šè‡ªåŠ¨æ•è· RUM äº‹ä»¶å¹¶å¡«å……å…¶ä¸»è¦å±æ€§ã€‚é€šè¿‡ `beforeSend` å›è°ƒå‡½æ•°ï¼Œæ‚¨å¯ä»¥åœ¨äº‹ä»¶å‘é€åˆ° FlashDuty ä¹‹å‰å¯¹å…¶è¿›è¡Œæ‹¦æˆªå’Œä¿®æ”¹ï¼Œæ”¯æŒä»¥ä¸‹æ“ä½œï¼š

- **ä¸°å¯Œäº‹ä»¶**ï¼šæ·»åŠ é¢å¤–çš„ä¸Šä¸‹æ–‡å±æ€§ã€‚
- **ä¿®æ”¹äº‹ä»¶**ï¼šæ›´æ”¹äº‹ä»¶å†…å®¹æˆ–å±è”½æ•æ„Ÿä¿¡æ¯ã€‚
- **ä¸¢å¼ƒäº‹ä»¶**ï¼šé€‰æ‹©æ€§åœ°ä¸¢å¼ƒç‰¹å®š RUM äº‹ä»¶ã€‚

`beforeSend` å›è°ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

- **event**ï¼šç”± RUM æµè§ˆå™¨ SDK ç”Ÿæˆçš„äº‹ä»¶ã€‚
- **context**ï¼šè§¦å‘äº‹ä»¶åˆ›å»ºçš„ä¸Šä¸‹æ–‡ã€‚

### ä¸Šä¸‹æ–‡ç±»å‹

ä¸åŒçš„äº‹ä»¶ç±»å‹å¯¹åº”ä¸åŒçš„ä¸Šä¸‹æ–‡ï¼š

- **View**ï¼š`Location` å¯¹è±¡ã€‚
- **Action**ï¼šè§¦å‘äº‹ä»¶çš„ `Event` å’Œå¤„ç†å †æ ˆã€‚
- **Resource (XHR)**ï¼š`XMLHttpRequest`ã€`PerformanceResourceTiming` å’Œå¤„ç†å †æ ˆã€‚
- **Resource (Fetch)**ï¼š`Request`ã€`Response`ã€`PerformanceResourceTiming` å’Œå¤„ç†å †æ ˆã€‚
- **Resource (Other)**ï¼š`PerformanceResourceTiming`ã€‚
- **Error**ï¼š`Error` å¯¹è±¡ã€‚
- **Long Task**ï¼š`PerformanceLongTaskTiming`ã€‚

### ä¸°å¯Œ RUM äº‹ä»¶

æ‚¨å¯ä»¥é€šè¿‡ `beforeSend` å›è°ƒä¸ºäº‹ä»¶æ·»åŠ ä¸Šä¸‹æ–‡å±æ€§ã€‚ä¾‹å¦‚ï¼Œä¸ºèµ„æºäº‹ä»¶çš„å“åº”å¤´æ·»åŠ æ•°æ®ï¼š

```javascript
flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  beforeSend: (event, context) => {
    if (event.type === "resource" && event.resource.type === "fetch") {
      event.context.responseHeaders = Object.fromEntries(
        context.response.headers
      );
    }
    return true;
  },
});
```

æ‚¨è¿˜å¯ä»¥é€šè¿‡å…¨å±€ä¸Šä¸‹æ–‡ API ä¸ºäº‹ä»¶æ·»åŠ å±æ€§ã€‚æ³¨æ„ï¼šä»… `event.context` ä¸­çš„å±æ€§ä¼šè¢« RUM SDK è¯†åˆ«ã€‚

### ä¿®æ”¹ RUM äº‹ä»¶å†…å®¹

æ‚¨å¯ä»¥é€šè¿‡ `beforeSend` ä¿®æ”¹äº‹ä»¶å†…å®¹ï¼Œä¾‹å¦‚ä»è§†å›¾ URL ä¸­å±è”½ç”µå­é‚®ä»¶åœ°å€ï¼š

```javascript
flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  beforeSend: (event) => {
    event.view.url = event.view.url.replace(/email=[^&]*/, "email=REDACTED");
  },
});
```

#### å¯ä¿®æ”¹çš„å±æ€§

ä»¥ä¸‹å±æ€§å¯ä»¥é€šè¿‡ `beforeSend` ä¿®æ”¹ï¼š

- **view.url**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå½“å‰é¡µé¢çš„ URLã€‚
- **view.referrer**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå‰ä¸€ä¸ªé¡µé¢çš„ URLã€‚
- **view.name**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå½“å‰è§†å›¾åç§°ã€‚
- **view.performance.lcp.resource_url**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼ˆLCPï¼‰çš„èµ„æº URLã€‚
- **service**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šåº”ç”¨çš„æœåŠ¡åç§°ã€‚
- **version**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šåº”ç”¨ç‰ˆæœ¬ã€‚
- **action.target.name**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨æˆ·äº¤äº’çš„å…ƒç´ ï¼ˆä»…é™è‡ªåŠ¨æ”¶é›†çš„æ“ä½œï¼‰ã€‚
- **error.message**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šé”™è¯¯æ¶ˆæ¯ã€‚
- **error.stack**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šé”™è¯¯å †æ ˆæˆ–è¡¥å……ä¿¡æ¯ã€‚
- **error.resource.url**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè§¦å‘é”™è¯¯çš„èµ„æº URLã€‚
- **resource.url**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šèµ„æº URLã€‚
- **long_task.scripts.source_url**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šé•¿ä»»åŠ¡çš„è„šæœ¬èµ„æº URLã€‚
- **long_task.scripts.invoker**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè°ƒç”¨è„šæœ¬çš„åç§°ã€‚
- **context**ï¼ˆå¯¹è±¡ï¼‰ï¼šé€šè¿‡å…¨å±€ä¸Šä¸‹æ–‡ APIã€è§†å›¾ä¸Šä¸‹æ–‡ API æˆ–æ‰‹åŠ¨ç”Ÿæˆäº‹ä»¶ï¼ˆå¦‚ `addError`ã€`addAction`ï¼‰æ·»åŠ çš„å±æ€§ã€‚

å…¶ä»–å±æ€§çš„ä¿®æ”¹å°†è¢«å¿½ç•¥ã€‚

### ä¸¢å¼ƒ RUM äº‹ä»¶

é€šè¿‡åœ¨ `beforeSend` ä¸­è¿”å› `false`ï¼Œå¯ä»¥ä¸¢å¼ƒç‰¹å®š RUM äº‹ä»¶ï¼ˆè§†å›¾äº‹ä»¶é™¤å¤–ï¼‰ï¼š

```javascript
flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  beforeSend: (event) => {
    if (shouldDiscard(event)) {
      return false;
    }
  },
});
```

## ç”¨æˆ·ä¼šè¯

é€šè¿‡ä¸º RUM ä¼šè¯æ·»åŠ ç”¨æˆ·ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥ï¼š

- è·Ÿè¸ªç‰¹å®šç”¨æˆ·çš„æµè§ˆè·¯å¾„ã€‚
- äº†è§£å“ªäº›ç”¨æˆ·å—é”™è¯¯å½±å“æœ€å¤§ã€‚
- ç›‘æ§å…³é”®ç”¨æˆ·çš„æ€§èƒ½ã€‚

### ç”¨æˆ·å±æ€§

ä»¥ä¸‹ä¸ºå¯é€‰çš„ç”¨æˆ·å±æ€§ï¼Œå»ºè®®è‡³å°‘æä¾›ä¸€ä¸ªï¼š

- **usr.id**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå”¯ä¸€ç”¨æˆ·æ ‡è¯†ç¬¦ã€‚
- **usr.name**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨æˆ·å‹å¥½åç§°ï¼Œé»˜è®¤åœ¨ RUM UI ä¸­æ˜¾ç¤ºã€‚
- **usr.email**ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨æˆ·ç”µå­é‚®ä»¶ï¼Œè‹¥æ— åç§°åˆ™æ˜¾ç¤ºé‚®ä»¶ã€‚

æ‚¨è¿˜å¯ä»¥æ·»åŠ é¢å¤–å±æ€§ï¼Œä¾‹å¦‚ç”¨æˆ·è®¡åˆ’æˆ–ç”¨æˆ·ç»„ä¿¡æ¯ï¼Œä»¥å¢å¼ºè¿‡æ»¤èƒ½åŠ›ã€‚

### ç”¨æˆ·ä¼šè¯ API

#### è®¾ç½®ç”¨æˆ·ä¼šè¯

```javascript
flashcatRum.setUser({
  id: "1234",
  name: "John Doe",
  email: "john@doe.com",
  plan: "premium",
});
```

#### è·å–ç”¨æˆ·ä¼šè¯

```javascript
const user = flashcatRum.getUser();
```

#### æ·»åŠ /è¦†ç›–ç”¨æˆ·å±æ€§

```javascript
flashcatRum.setUserProperty("name", "John Doe");
```

#### åˆ é™¤ç”¨æˆ·å±æ€§

```javascript
flashcatRum.removeUserProperty("name");
```

#### æ¸…é™¤ç”¨æˆ·ä¼šè¯

```javascript
flashcatRum.clearUser();
```

**æ³¨æ„**ï¼š

- ç”¨æˆ·ä¼šè¯ä¿¡æ¯æ›´æ”¹åï¼Œä¹‹åçš„ RUM äº‹ä»¶å°†åŒ…å«æ›´æ–°åçš„ä¿¡æ¯ã€‚
- æ³¨é”€ï¼ˆè°ƒç”¨ `clearUser`ï¼‰åï¼Œæœ€åä¸€ä¸ªè§†å›¾ä»ä¿ç•™ç”¨æˆ·ä¿¡æ¯ï¼Œä½†åç»­è§†å›¾å’Œä¼šè¯çº§åˆ«æ•°æ®ä¸ä¼šã€‚

## é‡‡æ ·

é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlashDuty RUM ä¼šæ”¶é›†æ‰€æœ‰ä¼šè¯çš„æ•°æ®ã€‚æ‚¨å¯ä»¥é€šè¿‡ `sessionSampleRate` å‚æ•°è®¾ç½®é‡‡æ ·ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰æ¥å‡å°‘æ”¶é›†çš„ä¼šè¯æ•°é‡ã€‚ä¾‹å¦‚ï¼Œé‡‡é›† 90% çš„ä¼šè¯ï¼š

```javascript
flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  sessionSampleRate: 90,
});
```

è¢«é‡‡æ ·çš„ä¼šè¯å°†ä¸æ”¶é›†ä»»ä½•é¡µé¢è§†å›¾åŠå…¶ç›¸å…³é¥æµ‹æ•°æ®ã€‚

## ç”¨æˆ·è·Ÿè¸ªåŒæ„

ä¸ºéµå®ˆ GDPRã€CCPA ç­‰éšç§æ³•è§„ï¼ŒFlashDuty RUM å…è®¸åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®ç”¨æˆ·è·Ÿè¸ªåŒæ„çŠ¶æ€ï¼ˆ`trackingConsent`ï¼‰ã€‚å¯é€‰å€¼ï¼š

- **"granted"**ï¼šå¼€å§‹æ”¶é›†æ•°æ®å¹¶å‘é€åˆ° FlashDutyã€‚
- **"not-granted"**ï¼šä¸æ”¶é›†ä»»ä½•æ•°æ®ã€‚

æ‚¨å¯ä»¥é€šè¿‡ `setTrackingConsent` API åœ¨åˆå§‹åŒ–åæ›´æ”¹åŒæ„çŠ¶æ€ï¼š

- ä» `"granted"` æ›´æ”¹ä¸º `"not-granted"`ï¼šåœæ­¢ RUM ä¼šè¯ï¼Œæ•°æ®ä¸å†å‘é€ã€‚
- ä» `"not-granted"` æ›´æ”¹ä¸º `"granted"`ï¼šå¦‚æœæ²¡æœ‰æ´»è·ƒä¼šè¯ï¼Œå°†åˆ›å»ºæ–°ä¼šè¯å¹¶æ¢å¤æ•°æ®æ”¶é›†ã€‚

**æ³¨æ„**ï¼šåŒæ„çŠ¶æ€ä¸ä¼šåœ¨æ ‡ç­¾é¡µé—´åŒæ­¥æˆ–æŒä¹…åŒ–ï¼Œæ‚¨éœ€è¦åœ¨åˆå§‹åŒ–æˆ–é€šè¿‡ `setTrackingConsent` æä¾›ç”¨æˆ·å†³å®šã€‚

### ç¤ºä¾‹ï¼šå¤„ç†ç”¨æˆ·åŒæ„

```javascript
flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  trackingConsent: "not-granted",
});

acceptCookieBannerButton.addEventListener("click", function () {
  flashcatRum.setTrackingConsent("granted");
});
```

## è§†å›¾ä¸Šä¸‹æ–‡

è§†å›¾äº‹ä»¶çš„ä¸Šä¸‹æ–‡å¯ä¿®æ”¹ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ API ä¸ºå½“å‰è§†å›¾åŠå…¶å­äº‹ä»¶ï¼ˆå¦‚æ“ä½œã€é”™è¯¯ã€è®¡æ—¶ï¼‰æ·»åŠ æˆ–ä¿®æ”¹ä¸Šä¸‹æ–‡ï¼š

- `startView`ï¼šå¯åŠ¨è§†å›¾æ—¶æŒ‡å®šä¸Šä¸‹æ–‡ã€‚
- `setViewContextProperty`ï¼šä¸ºå½“å‰è§†å›¾æ·»åŠ æˆ–ä¿®æ”¹ä¸Šä¸‹æ–‡å±æ€§ã€‚
- `setViewContext`ï¼šæ›¿æ¢å½“å‰è§†å›¾çš„ä¸Šä¸‹æ–‡ã€‚

### ç¤ºä¾‹ï¼šæ·»åŠ è§†å›¾ä¸Šä¸‹æ–‡

```javascript
flashcatRum.setViewContextProperty("activity", {
  hasPaid: true,
  amount: 23.42,
});
```

### ç¤ºä¾‹ï¼šæ›¿æ¢è§†å›¾ä¸Šä¸‹æ–‡

```javascript
flashcatRum.setViewContext({
  originalUrl: "shopist.io/department/chairs",
});
```

## é”™è¯¯ä¸Šä¸‹æ–‡

åœ¨æ•è·é”™è¯¯æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ `dd_context` å±æ€§ä¸ºé”™è¯¯å¯¹è±¡é™„åŠ æœ¬åœ°ä¸Šä¸‹æ–‡ï¼ŒRUM SDK ä¼šè‡ªåŠ¨å°†å…¶åˆå¹¶åˆ°æœ€ç»ˆé”™è¯¯äº‹ä»¶ä¸Šä¸‹æ–‡ä¸­ã€‚

```javascript
const error = new Error("Something went wrong");
error.dd_context = { component: "Menu", param: 123 };
throw error;
```

## å…¨å±€ä¸Šä¸‹æ–‡

å…¨å±€ä¸Šä¸‹æ–‡ä¼šé™„åŠ åˆ°æ‰€æœ‰ RUM äº‹ä»¶ä¸Šï¼Œæ”¯æŒä»¥ä¸‹æ“ä½œï¼š

- **æ·»åŠ å…¨å±€ä¸Šä¸‹æ–‡å±æ€§**ï¼š
  ```javascript
  flashcatRum.setGlobalContextProperty("activity", {
    hasPaid: true,
    amount: 23.42,
  });
  ```
- **åˆ é™¤å…¨å±€ä¸Šä¸‹æ–‡å±æ€§**ï¼š
  ```javascript
  flashcatRum.removeGlobalContextProperty("codeVersion");
  ```
- **æ›¿æ¢å…¨å±€ä¸Šä¸‹æ–‡**ï¼š
  ```javascript
  flashcatRum.setGlobalContext({
    codeVersion: 34,
  });
  ```
- **æ¸…é™¤å…¨å±€ä¸Šä¸‹æ–‡**ï¼š
  ```javascript
  flashcatRum.clearGlobalContext();
  ```
- **è¯»å–å…¨å±€ä¸Šä¸‹æ–‡**ï¼š
  ```javascript
  const context = flashcatRum.getGlobalContext();
  ```

### ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸ

é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€ä¸Šä¸‹æ–‡å’Œç”¨æˆ·ä¸Šä¸‹æ–‡å­˜å‚¨åœ¨å½“å‰é¡µé¢å†…å­˜ä¸­ï¼Œå› æ­¤ï¼š

- é¡µé¢å®Œå…¨åˆ·æ–°åä¸ä¼šä¿ç•™ã€‚
- ä¸åŒæ ‡ç­¾é¡µæˆ–çª—å£é—´ä¸å…±äº«ã€‚

å¯ç”¨ `storeContextsAcrossPages` é€‰é¡¹å¯ä»¥å°†ä¸Šä¸‹æ–‡å­˜å‚¨åˆ° `localStorage`ï¼Œæ”¯æŒï¼š

- é¡µé¢åˆ·æ–°åä¿ç•™ä¸Šä¸‹æ–‡ã€‚
- åŒä¸€åŸŸåä¸‹çš„æ ‡ç­¾é¡µé—´åŒæ­¥ä¸Šä¸‹æ–‡ã€‚

#### ç¤ºä¾‹ï¼š

```javascript
flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  storeContextsAcrossPages: true,
});
```

#### é™åˆ¶ï¼š

- ä¸å»ºè®®åœ¨ä¸Šä¸‹æ–‡ä¸­å­˜å‚¨ä¸ªäººèº«ä»½ä¿¡æ¯ï¼Œå› ä¸º `localStorage` æ•°æ®ä¼šè¶…å‡ºç”¨æˆ·ä¼šè¯ç”Ÿå‘½å‘¨æœŸã€‚
- ä¸ `trackSessionAcrossSubdomains` é€‰é¡¹ä¸å…¼å®¹ï¼Œå› ä¸º `localStorage` ä»…åœ¨åŒä¸€åŸŸåä¸‹å…±äº«ã€‚
- `localStorage` å®¹é‡é™åˆ¶ä¸º 5 MiBï¼Œéœ€ç¡®ä¿åº”ç”¨æ•°æ®ã€FlashDuty ä¸Šä¸‹æ–‡åŠå…¶ä»–ç¬¬ä¸‰æ–¹æ•°æ®æ€»å’Œåœ¨æ­¤èŒƒå›´å†…ã€‚

## å¾®å‰ç«¯æ”¯æŒ

FlashDuty RUM æ”¯æŒå¾®å‰ç«¯æ¶æ„ï¼Œé€šè¿‡å †æ ˆè·Ÿè¸ªï¼ˆstacktraceï¼‰æœºåˆ¶è¯†åˆ«äº‹ä»¶æ¥æºã€‚æ‚¨éœ€è¦ä»åº”ç”¨æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åä¸­æå– `service` å’Œ `version` å±æ€§ã€‚

### ä½¿ç”¨æ–¹æ³•

åœ¨ `beforeSend` ä¸­æ ¹æ®å †æ ˆä¿¡æ¯è¦†ç›– `service` å’Œ `version` å±æ€§ï¼š

```javascript
const SERVICE_REGEX = /some-pathname\/(?<service>\w+)\/(?<version>\w+)\//;

flashcatRum.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  site: "flashduty.com",
  beforeSend: (event, context) => {
    const stack = context?.handlingStack || event?.error?.stack;
    const { service, version } = stack?.match(SERVICE_REGEX)?.groups;

    if (service && version) {
      event.service = service;
      event.version = version;
    }

    return true;
  },
});
```

åœ¨ RUM æµè§ˆå™¨ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `service` å±æ€§è¿‡æ»¤äº‹ä»¶ã€‚

### é™åˆ¶

ä»¥ä¸‹äº‹ä»¶æ— æ³•å½’å› äºç‰¹å®šæ¥æºï¼Œå› æ­¤ä¸åŒ…å«å¤„ç†å †æ ˆï¼š

- è‡ªåŠ¨æ”¶é›†çš„æ“ä½œäº‹ä»¶ã€‚
- é XHR å’Œ Fetch çš„èµ„æºäº‹ä»¶ã€‚
- è§†å›¾äº‹ä»¶ï¼ˆå¯é€šè¿‡è¦†ç›–è§†å›¾åç§°è§£å†³ï¼‰ã€‚
- CORS å’Œ CSP è¿è§„äº‹ä»¶ã€‚

## é›†æˆ RUM ä¸åˆ†å¸ƒå¼è¿½è¸ª

é›†æˆ RUM ä¸åˆ†å¸ƒå¼è¿½è¸ªï¼Œå¯è®©æ‚¨å°† Web å’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„è¯·æ±‚ä¸å…¶å¯¹åº”çš„åç«¯è·Ÿè¸ªå…³è”èµ·æ¥ã€‚è¿™ç§ç»„åˆè®©æ‚¨èƒ½å¤Ÿä¸€ç›®äº†ç„¶åœ°æŸ¥çœ‹å®Œæ•´çš„å‰ç«¯å’Œåç«¯æ•°æ®ã€‚

ä½¿ç”¨æ¥è‡ª RUM çš„å‰ç«¯æ•°æ®ä»¥åŠæ¥è‡ªè·Ÿè¸ª ID æ³¨å…¥çš„åç«¯ã€åŸºç¡€è®¾æ–½å’Œæ—¥å¿—ä¿¡æ¯æ¥æŸ¥æ˜å †æ ˆä¸­ä»»ä½•åœ°æ–¹çš„é—®é¢˜å¹¶äº†è§£ç”¨æˆ·çš„ä½“éªŒã€‚

### ä½¿ç”¨æ–¹æ³•

åˆå§‹åŒ– RUM SDKã€‚ä½¿ç”¨ `allowedTracingUrls` æ¥åˆå§‹åŒ–å‚æ•°ï¼Œéœ€é…ç½®å½“å‰åº”ç”¨çš„ API æœåŠ¡åŸŸåã€‚

<Tabs>
  <Tab title="NPM">
```javascript
import { flashcatRum } from "@flashcatcloud/browser-rum";

flashcatRum.init({
applicationId: "<YOUR_APPLICATION_ID>", // ä»åº”ç”¨ç®¡ç†é¡µé¢è·å–
clientToken: "<YOUR_CLIENT_TOKEN>", // ä»åº”ç”¨ç®¡ç†é¡µé¢è·å–
service: "<SERVICE_NAME>", // æœåŠ¡åç§°ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æœåŠ¡
env: "<ENV_NAME>", // ç¯å¢ƒæ ‡è¯†
version: "1.0.0", // åº”ç”¨ç‰ˆæœ¬å·
sessionSampleRate: 100, // é‡‡æ ·ç‡
allowedTracingUrls: ["https://api.example.com", /https:\/\/.*\.my-api-domain\.com/, (url) => url.startsWith("https://api.example.com")], // éœ€è¦è·Ÿè¸ªçš„ url åˆ—è¡¨
traceSampleRate: 20 // å¯é€‰å‚æ•°ï¼Œè¦è·Ÿè¸ªçš„è¯·æ±‚ç™¾åˆ†æ¯”ï¼š100 ä¸ºæ‰€æœ‰ï¼Œ0 ä¸ºæ— ã€‚é»˜è®¤å€¼ï¼š100
});

```
  </Tab>
  <Tab title="CDNåŒæ­¥åŠ è½½">
```

<script
  src="https://static.flashcat.cloud/browser-sdk/v0/flashcat-rum.js"
  type="text/javascript">
</script>
<script>
  window.FC_RUM && window.FC_RUM.init({
  applicationId: "<YOUR_APPLICATION_ID>",
  clientToken: "<YOUR_CLIENT_TOKEN>",
  service: "<SERVICE_NAME>",
  env: "<ENV_NAME>",
  version: "1.0.0",
  sessionSampleRate: 100,
  allowedTracingUrls: ["https://api.example.com", /https:\/\/.*\.my-api-domain\.com/, (url) => url.startsWith("https://api.example.com")]
});
</script>

```
  </Tab>
  <Tab title="CDNå¼‚æ­¥åŠ è½½">
```

<script>
  (function(h,o,u,n,d) {
    h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
    d=o.createElement(u);d.async=1;d.src=n
    n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
  })(window,document,'script','https://static.flashcat.cloud/browser-sdk/v0/flashcat-rum.js','FC_RUM')
  window.FC_RUM.onReady(function() {
    window.FC_RUM.init({
      applicationId: "<YOUR_APPLICATION_ID>",
      clientToken: "<YOUR_CLIENT_TOKEN>",
      service: "<SERVICE_NAME>",
      env: "<ENV_NAME>",
      version: "1.0.0",
      sessionSampleRate: 100,
      allowedTracingUrls: ["https://api.example.com", /https:\/\/.*\.my-api-domain\.com/, (url) => url.startsWith("https://api.example.com")]
    })
  })
</script>

````
  </Tab>
</Tabs>


allowedTracingUrls åŒ¹é…å®Œæ•´ URLï¼ˆ`<scheme>://<host>[:<port>]/<path>[?<query>][#<fragment>]`ï¼‰ã€‚å®ƒæ¥å—ä»¥ä¸‹ç±»å‹ï¼š

- **Stringï¼š** åŒ¹é…ä»»ä½•ä»¥è¯¥å€¼å¼€å¤´çš„ URLï¼Œä¾‹å¦‚ `https://api.example.com ` åŒ¹é… `https://api.example.com/v1/resource`ã€‚
- **RegExpï¼š** ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„ test() æ–¹æ³•æ£€æŸ¥ URL æ˜¯å¦åŒ¹é…ã€‚
- **Functionï¼š** æ¥æ”¶ URL ä½œä¸ºå‚æ•°æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå½“å‡½æ•°è¿”å› `true` æ—¶è¡¨ç¤º URL åŒ¹é…æˆåŠŸã€‚

### å¦‚ä½•å…³è”
    åˆ†å¸ƒå¼è¿½è¸ªåè®®é€šè¿‡åœ¨Headerä¸Šæ·»åŠ å¯¹åº”çš„å¤´éƒ¨å­—æ®µ(traceparentã€tracestate)å®ç°ï¼Œä»¥ä¸‹æ˜¯å¯¹ç›¸åº”headerçš„è¯´æ˜:
:::highlight gray
```traceparent:[version]-[trace id]-[parent id]-[trace flags]```

    - version: å½“å‰ä¸º00
    - trace id: 128 bits çš„trace IDé€šè¿‡16è¿›åˆ¶å¤„ç†åå˜æˆ32ä¸ªå­—ç¬¦
    - parent id: 64 bitsçš„span ID, 16è¿›åˆ¶å¤„ç†åä¸º16ä¸ªå­—ç¬¦
    - trace flags: ä»£è¡¨æ˜¯å¦æœ‰é™é‡‡æ ·, 01ä»£è¡¨å‘½ä¸­é‡‡æ ·ï¼Œ00ä»£è¡¨éé‡‡æ ·

```tracestate: dd=s:[sampling priority]; o:[origin]```

    - sampling priority: 1ä»£è¡¨traceè¢«é‡‡æ ·
    - origin: å§‹ç»ˆä¸ºRUMï¼Œä»£è¡¨é€šè¿‡RUM SDKé‡‡é›†
:::
**ç¤ºä¾‹ï¼š**
`traceparent: 00-00000000000000008448eb211c80319c-b7ad6b7169203331s-01`
`tracestate: dd=s:1;o:rum`

### å¦‚ä½•éªŒè¯
æ·»åŠ é…ç½®åï¼Œå¯æŸ¥çœ‹ä»åº”ç”¨ä¸­å‘é€çš„è¯·æ±‚ï¼Œå¦‚èƒ½æ­£ç¡®æºå¸¦å¯¹åº”çš„headeråˆ™è¯´æ˜é…ç½®æ— è¯¯ã€‚


![image.png](https://api.apifox.com/api/v1/projects/4386769/resources/534953/image-preview)

:::highlight orange ğŸ“Œ
å¦‚æ‚¨çš„httpè¯·æ±‚æ¶‰åŠåˆ°è·¨åŸŸé—®é¢˜ï¼Œæ‚¨éœ€è¦ç¡®ä¿è¯·æ±‚å¯é€šè¿‡è·¨åŸŸæ£€æµ‹ï¼Œç¡®ä¿å¯¹åº”çš„server [æœ‰è·¨åŸŸç›¸å…³é…ç½®](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Access-Control-Allow-Headers)ï¼Œæ”¯æŒ [é¢„æ£€è¯·æ±‚](https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request) è¯·æ±‚è®¿é—®ã€‚
:::

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿æ­£ç¡®é…ç½® `applicationId` å’Œ `clientToken`ï¼Œä»¥é¿å…æ•°æ®ä¸Šä¼ å¤±è´¥ã€‚
- æ ¹æ®åº”ç”¨éœ€æ±‚è°ƒæ•´é‡‡æ ·ç‡å’Œéšç§è®¾ç½®ï¼Œå¹³è¡¡æ•°æ®é‡ä¸åˆè§„æ€§ã€‚
- å¯¹äºå¾®å‰ç«¯æˆ–å¤æ‚å‰ç«¯æ¡†æ¶ï¼Œå»ºè®®åœ¨æ¡†æ¶è·¯ç”±çº§åˆ«å®ç° `startView` é€»è¾‘ã€‚

## æ›´å¤šä¿¡æ¯

æœ‰å…³ FlashDuty RUM çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—® [FlashDuty SDK](https://github.com/flashcatcloud/browser-sdk)ã€‚
````
