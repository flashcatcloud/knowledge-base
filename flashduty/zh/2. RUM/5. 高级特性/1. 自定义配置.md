---
title: "RUM 高级配置指南"
description: "深入了解 FlashCat RUM 的高级配置选项，实现更精细的用户体验监控。"
date: "2024-05-09T10:00:00+08:00"
url: "https://docs.flashcat.cloud/zh/flashduty/rum/advanced-configuration"
---

## 概述

---

本指南介绍 FlashCat RUM 的高级配置选项，帮助您根据业务需求定制监控方案。通过这些配置，您可以更精确地控制数据采集范围、优化性能开销，并实现更深入的用户体验分析。

## 全局配置

---

### 初始化选项

在初始化 RUM SDK 时，您可以设置以下高级选项：

```javascript
flashcatRum.init({
  applicationId: "您的应用ID",
  clientToken: "您的客户端令牌",

  // 数据采集控制
  sampleRate: 100, // 采样率：1-100
  trackResources: true, // 是否跟踪资源加载
  trackLongTasks: true, // 是否跟踪长任务
  trackUserInteractions: true, // 是否跟踪用户交互
  trackErrors: true, // 是否跟踪错误

  // 性能优化
  maxBatchSize: 50, // 批量上报数据的最大条数
  flushTimeout: 30000, // 数据上报间隔（毫秒）

  // 隐私保护
  maskTextContent: true, // 是否掩码文本内容
  maskUserInput: true, // 是否掩码用户输入

  // 调试设置
  debug: false, // 是否启用调试模式
  silentMode: false, // 是否启用静默模式
});
```

### 用户标识

配置用户标识信息，实现跨会话分析：

```javascript
// 设置用户ID
flashcatRum.setUser({
  id: "user123", // 用户唯一标识
  name: "张三", // 用户名称
  email: "zhangsan@example.com", // 用户邮箱
  role: "premium", // 用户角色
});

// 清除用户信息
flashcatRum.clearUser();
```

## 数据采集配置

---

### 自定义维度

添加业务相关的自定义维度：

```javascript
// 全局维度
flashcatRum.addGlobalContext("business", {
  plan: "enterprise",
  region: "east-china",
});

// 视图维度
flashcatRum.startView({
  name: "商品详情",
  context: {
    category: "electronics",
    productId: "p123",
  },
});

// 事件维度
flashcatRum.addAction("purchase", {
  amount: 99.9,
  currency: "CNY",
});
```

### 资源监控

精细控制资源监控范围：

```javascript
flashcatRum.init({
  // ... 其他配置
  resourceUrlFilter: function (url) {
    // 只监控特定域名的资源
    return url.includes("api.example.com") || url.includes("cdn.example.com");
  },

  // 忽略特定类型的资源
  resourceTypes: ["script", "xhr", "fetch", "img"],

  // 资源采样率单独配置
  resourceSampleRate: 50,
});
```

### 错误监控

自定义错误处理和过滤：

```javascript
flashcatRum.init({
  // ... 其他配置

  // 错误过滤
  errorFilter: function (error) {
    // 忽略特定类型的错误
    if (error.message.includes("Script error")) {
      return false;
    }
    return true;
  },

  // 错误转换
  errorTransform: function (error) {
    // 添加自定义错误信息
    error.customField = "附加信息";
    return error;
  },
});

// 手动上报错误
flashcatRum.addError(new Error("业务异常"), {
  severity: "warning",
  context: {
    operation: "checkout",
  },
});
```

## 性能优化

---

### 数据上报策略

优化数据上报频率和批量：

```javascript
flashcatRum.init({
  // ... 其他配置

  // 批量上报配置
  maxBatchSize: 100, // 每批最多100条数据
  flushTimeout: 60000, // 每60秒上报一次
  maxPendingEvents: 1000, // 最多缓存1000条待上报数据

  // 网络状态感知
  networkStatusCheck: true, // 启用网络状态检查
  retryCount: 3, // 上报失败重试次数
  retryDelay: 1000, // 重试间隔（毫秒）
});
```

### 资源优化

减少监控对应用性能的影响：

```javascript
flashcatRum.init({
  // ... 其他配置

  // 限制监控资源大小
  maxResourceSize: 1024 * 1024, // 最大1MB

  // 忽略较小资源
  minResourceSize: 1024, // 最小1KB

  // 限制每页面最大监控资源数
  maxResourcesPerPage: 100,
});
```

## 隐私保护

---

### 数据脱敏

配置数据脱敏规则：

```javascript
flashcatRum.init({
  // ... 其他配置

  // 文本内容脱敏
  maskTextContent: true,
  textContentMaskRules: [
    { pattern: /\d{11}/, replacement: "***" }, // 手机号
    { pattern: /\d{16,19}/, replacement: "***" }, // 银行卡号
  ],

  // 用户输入脱敏
  maskUserInput: true,
  inputMaskRules: [
    { selector: '[name="password"]', mask: true },
    { selector: '[name="credit-card"]', mask: true },
  ],
});
```

### 隐私合规

确保数据采集符合隐私法规：

```javascript
// 设置用户跟踪同意状态
flashcatRum.setTrackingConsent("granted");

// 配置数据保留策略
flashcatRum.init({
  // ... 其他配置

  // 数据存储位置
  dataCenter: "cn-east",

  // 数据保留时间
  dataRetention: 90, // 天

  // 敏感数据处理
  sensitiveDataHandling: "mask", // 'mask' 或 'drop'
});
```

## 调试工具

---

### 开发模式

启用开发模式获取详细日志：

```javascript
flashcatRum.init({
  // ... 其他配置
  debug: true,
  debugLevel: "verbose", // 'error' | 'warn' | 'info' | 'verbose'
});

// 添加自定义日志
flashcatRum.logger.info("自定义日志信息", {
  context: "业务操作",
});
```

### 性能分析

启用性能分析工具：

```javascript
flashcatRum.init({
  // ... 其他配置

  // 启用性能分析
  enableProfiling: true,

  // 性能分析配置
  profiling: {
    samplingRate: 10, // 采样率10%
    stackTraceLimit: 50, // 堆栈深度限制
    timeThreshold: 100, // 记录超过100ms的操作
  },
});
```

## 高级功能

---

### 自定义数据上报

配置自定义数据上报端点：

```javascript
flashcatRum.init({
  // ... 其他配置

  // 自定义上报地址
  endpoint: "https://custom.example.com/rum",

  // 自定义请求头
  headers: {
    "X-Custom-Header": "value",
  },

  // 数据转换
  beforeSend: function (data) {
    // 在发送前处理数据
    data.customField = "自定义值";
    return data;
  },
});
```

### 集成第三方服务

与其他监控服务集成：

```javascript
flashcatRum.init({
  // ... 其他配置

  // 启用第三方集成
  integrations: {
    googleAnalytics: true,
    errorTracking: true,
  },

  // 配置集成参数
  integrationConfig: {
    googleAnalytics: {
      trackingId: "UA-XXXXX-Y",
    },
  },
});
```

### 自定义插件

开发和注册自定义插件：

```javascript
// 定义插件
const customPlugin = {
  name: "customPlugin",
  init: function (sdk) {
    // 插件初始化逻辑
  },
  beforeSend: function (data) {
    // 数据处理逻辑
    return data;
  },
};

// 注册插件
flashcatRum.registerPlugin(customPlugin);
```

## 最佳实践

---

1. **性能优化**

   - 合理设置采样率
   - 优化数据上报策略
   - 控制监控资源范围

2. **数据质量**

   - 设置合适的过滤规则
   - 规范自定义维度
   - 定期验证数据准确性

3. **隐私保护**

   - 实施数据脱敏
   - 遵守隐私法规
   - 控制数据访问权限

4. **可维护性**
   - 使用语义化的命名
   - 保持配置的一致性
   - 做好文档记录

通过合理配置这些高级选项，您可以构建一个既高效又安全的用户体验监控系统。根据您的具体需求，选择合适的配置组合，在监控全面性和系统性能之间找到最佳平衡点。
