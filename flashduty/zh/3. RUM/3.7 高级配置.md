---
title: "RUM 高级配置"
description: "了解如何通过高级配置选项自定义FlashCat实时用户监控(RUM)以满足您的特定需求。"
date: "2024-05-09T10:00:00+08:00"
url: "https://docs.flashcat.cloud/zh/flashduty/rum/advanced-configuration"
---

## 概述
---

FlashCat RUM提供了广泛的配置选项，允许您自定义数据收集、隐私设置和性能优化。本指南涵盖了可用的高级配置选项，帮助您根据特定需求调整RUM实施。

## 核心配置选项
---

初始化RUM SDK时，您可以提供几个核心配置选项：

### 基本设置

```javascript
flashcatRum.init({
  applicationId: 'YOUR_APPLICATION_ID', // 必需
  clientToken: 'YOUR_CLIENT_TOKEN',     // 必需
  site: 'flashcat.cloud',               // 可选，默认为'flashcat.cloud'
  service: 'my-web-app',                // 可选，您的服务名称
  env: 'production',                    // 可选，环境名称
  version: '1.2.3',                     // 可选，应用程序版本
});
```

| 选项 | 类型 | 默认值 | 描述 |
|--------|------|---------|-------------|
| `applicationId` | string | - | 您的RUM应用程序ID（必需） |
| `clientToken` | string | - | 您的RUM客户端令牌（必需） |
| `site` | string | 'flashcat.cloud' | 发送数据的FlashCat站点 |
| `service` | string | - | 您的服务或应用程序名称 |
| `env` | string | 'production' | 环境（例如，'production'、'staging'、'development'） |
| `version` | string | - | 您的应用程序版本 |

## 数据收集配置
---

您可以控制RUM SDK收集的数据类型：

```javascript
flashcatRum.init({
  // ... 基本设置
  trackViewsManually: false,       // 是否手动跟踪视图
  trackInteractions: true,         // 是否跟踪用户交互
  trackResources: true,            // 是否跟踪资源加载
  trackLongTasks: true,            // 是否跟踪长任务
  trackErrors: true,               // 是否跟踪错误
  trackNetworkRequests: true,      // 是否跟踪网络请求
  trackConsoleErrors: true,        // 是否跟踪控制台错误
  trackNavigationTimings: true,    // 是否跟踪导航时间
  trackSessionAcrossSubdomains: false, // 是否跟踪子域名之间的会话
});
```

## 采样配置
---

采样配置允许您控制收集数据的百分比，这对于高流量应用程序特别有用：

```javascript
flashcatRum.init({
  // ... 基本设置
  sampleRate: 100,                 // 会话采样率（1-100）
  // 其他采样率配置
  errorSampleRate: 100,            // 错误采样率（1-100）
});
```

| 选项 | 类型 | 默认值 | 描述 |
|--------|------|---------|-------------|
| `sampleRate` | number | 100 | 收集数据的会话百分比（1-100） |
| `resourceSampleRate` | number | 100 | 收集资源数据的会话百分比（1-100） |
| `errorSampleRate` | number | 100 | 收集错误的会话百分比（1-100） |

## 隐私配置
---

隐私配置允许您控制收集的数据中包含的敏感信息：

```javascript
flashcatRum.init({
  // ... 基本设置
  defaultPrivacyLevel: 'mask-user-input', // 隐私级别
  trackingConsent: 'pending',             // 跟踪同意状态
  enableExperimentalFeatures: [],         // 实验性功能
});
```

| 选项 | 类型 | 默认值 | 描述 |
|--------|------|---------|-------------|
| `defaultPrivacyLevel` | string | 'mask-user-input' | 隐私级别：'allow'（允许所有数据）、'mask'（掩盖所有数据）或'mask-user-input'（仅掩盖用户输入） |
| `trackingConsent` | string | 'granted' | 跟踪同意状态：'pending'（待定）、'granted'（已授予）或'not-granted'（未授予） |

## 性能配置
---

性能配置允许您优化RUM SDK的性能影响：

```javascript
flashcatRum.init({
  // ... 基本设置
  maxBatchSize: 50,                // 最大批处理大小
  maxMessageSize: 256000,          // 最大消息大小（字节）
  flushTimeout: 30000,             // 刷新超时（毫秒）
  batchBytesLimit: 16000,          // 批处理字节限制
});
```

## 集成配置
---

集成配置允许您将RUM与其他工具和服务集成：

```javascript
flashcatRum.init({
  // ... 基本设置
  allowedTracingOrigins: [         // 允许的跟踪源
    'https://api.example.com',
    /https:\/\/.*\.my-api\.com/
  ],
  traceSampleRate: 100,            // 跟踪采样率
  analyticsEnabled: true,          // 是否启用分析
});
```

## 用户识别
---

您可以配置RUM SDK以识别和跟踪用户：

```javascript
// 在初始化时设置用户
flashcatRum.init({
  // ... 其他配置选项
  userData: {
    id: 'user-123',
    name: '张三',
    email: 'zhangsan@example.com',
    plan: 'premium'
  }
});

// 或者在初始化后设置用户
flashcatRum.setUser({
  id: 'user-123',
  name: '张三',
  email: 'zhangsan@example.com',
  plan: 'premium'
});
```

您可以添加任何自定义属性来丰富用户数据。但是，请避免包含敏感个人信息，除非您已配置适当的隐私设置。

## 自定义属性
---

您可以向RUM事件添加自定义属性，以提供额外的上下文：

```javascript
// 全局自定义属性
flashcatRum.init({
  // ... 其他配置选项
  globalContext: {
    theme: 'dark',
    betaFeatures: true
  }
});

// 更新全局上下文
flashcatRum.addRumGlobalContext('cart_size', 5);

// 为特定视图添加上下文
flashcatRum.startView({
  name: '产品页面',
  context: {
    product_id: '12345',
    category: '电子产品'
  }
});

// 为特定操作添加上下文
flashcatRum.addAction('click', '添加到购物车', {
  product_id: '12345',
  price: 99.99
});
```

## 会话管理
---

您可以配置RUM SDK如何管理用户会话：

```javascript
flashcatRum.init({
  // ... 其他配置选项
  sessionSampleRate: 100,               // 会话采样率
  trackUserInteractions: true,          // 是否跟踪用户交互
  trackSessionAcrossSubdomains: true,   // 是否跟踪子域名之间的会话
  useSecureSessionCookie: true,         // 是否使用安全会话Cookie
  useCrossSiteSessionCookie: false      // 是否使用跨站会话Cookie
});
```

您还可以手动启动和结束会话：

```javascript
// 启动新会话
flashcatRum.startSession();

// 结束当前会话
flashcatRum.endSession();
```

## 资源过滤
---

您可以配置RUM SDK过滤要跟踪的资源：

```javascript
flashcatRum.init({
  // ... 其他配置选项
  resourceSampleRate: 100,              // 资源采样率
  trackResources: true,                 // 是否跟踪资源
  resourceUrlFilter: function(url) {    // 资源URL过滤器
    // 排除图像和字体
    return !url.match(/\.(png|jpg|gif|svg|woff|woff2)$/);
  }
});
```

## 错误过滤
---

您可以配置RUM SDK过滤要跟踪的错误：

```javascript
flashcatRum.init({
  // ... 其他配置选项
  trackErrors: true,                    // 是否跟踪错误
  errorFilter: function(error) {        // 错误过滤器
    // 排除某些类型的错误
    if (error.message && error.message.indexOf('Script error') !== -1) {
      return false; // 不跟踪
    }
    return true; // 跟踪
  }
});
```

## 性能优化
---

要优化RUM SDK的性能，请考虑以下策略：

1. **调整采样率**：对于高流量应用程序，降低采样率以减少数据量。

   ```javascript
   flashcatRum.init({
     // ... 其他配置选项
     sampleRate: 20, // 只跟踪20%的会话
     resourceSampleRate: 20 // 只跟踪20%的资源
   });
   ```

2. **选择性跟踪**：只跟踪您需要的数据类型。

   ```javascript
   flashcatRum.init({
     // ... 其他配置选项
     trackResources: true,
     trackLongTasks: false, // 禁用长任务跟踪
     trackErrors: true,
     trackUserInteractions: true
   });
   ```

3. **资源过滤**：过滤不需要跟踪的资源。

   ```javascript
   flashcatRum.init({
     // ... 其他配置选项
     resourceUrlFilter: function(url) {
       // 只跟踪API调用和关键资源
       return url.includes('/api/') || url.includes('/critical/');
     }
   });
   ```

4. **批处理配置**：优化数据发送的批处理。

   ```javascript
   flashcatRum.init({
     // ... 其他配置选项
     maxBatchSize: 100, // 增加批处理大小
     flushTimeout: 60000 // 增加刷新超时
   });
   ```

## 跟踪自定义事件
---

您可以使用RUM SDK跟踪自定义事件：

```javascript
// 跟踪自定义事件
flashcatRum.addAction('custom', '用户登录', {
  method: 'email',
  success: true,
  duration_ms: 350
});

// 跟踪自定义错误
flashcatRum.addError('支付处理失败', {
  source: 'custom',
  payment_method: 'credit_card',
  amount: 99.99
});

// 手动启动视图
flashcatRum.startView({
  name: '结账流程',
  url: '/checkout'
});
```

## 与分析工具集成
---

您可以将RUM与其他分析工具集成：

```javascript
// 与Google Analytics集成
flashcatRum.init({
  // ... 其他配置选项
  beforeSend: function(event) {
    // 将RUM事件发送到Google Analytics
    if (event.type === 'action' && window.ga) {
      window.ga('send', 'event', 'RUM', event.action.type, event.action.name);
    }
    return event; // 返回事件以继续正常处理
  }
});
```

## 调试配置
---

在开发过程中，您可以启用调试模式以获取更多日志信息：

```javascript
flashcatRum.init({
  // ... 其他配置选项
  debug: true // 在控制台中启用详细日志
});
```

## 完整配置示例
---

以下是一个包含大多数配置选项的完整示例：

```javascript
flashcatRum.init({
  // 核心设置
  applicationId: 'YOUR_APPLICATION_ID',
  clientToken: 'YOUR_CLIENT_TOKEN',
  site: 'flashcat.cloud',
  service: 'my-web-app',
  env: 'production',
  version: '1.2.3',
  
  // 数据收集
  trackViewsManually: false,
  trackInteractions: true,
  trackResources: true,
  trackLongTasks: true,
  trackErrors: true,
  
  // 采样
  sampleRate: 100,
  resourceSampleRate: 100,
  
  // 隐私
  defaultPrivacyLevel: 'mask-user-input',
  trackingConsent: 'granted',
  
  // 用户识别
  userData: {
    id: 'user-123',
    name: '张三',
    plan: 'premium'
  },
  
  // 全局上下文
  globalContext: {
    theme: 'dark',
    betaFeatures: true
  },
  
  // 性能
  maxBatchSize: 50,
  flushTimeout: 30000,
  
  // 集成
  allowedTracingOrigins: [
    'https://api.example.com'
  ],
  
  // 调试
  debug: false
});
```

## 联系支持
---

如果您在配置RUM SDK时需要帮助，请联系FlashCat支持：

- 电子邮件：support@flashcat.cloud
- 支持门户：https://support.flashcat.cloud
- 应用内聊天：点击FlashCat控制台中的"帮助"按钮

通过利用这些高级配置选项，您可以自定义FlashCat RUM以满足您的特定需求，优化性能，并确保适当的隐私保护。
