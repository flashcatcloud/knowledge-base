
## 企业微信应用
---

您需要预先配置 `集成中心-即时消息-企业微信` 集成，才能发送消息卡片。如果不设置自定义内容，将采用系统默认模板，仅渲染常见标签信息：

- 我们列出了一些常见标签，您可自行删减；
- 在企业微信应用中，系统会自动帮您删除（因标签不存在导致的）渲染空行，您可放心配置

```
{{if (index .Labels "resource")}}resource：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}
{{if (index .Labels "metric")}}metric：{{index .Labels "metric"}}{{end}}
{{if (index .Labels "prom_ql")}}prom_ql：{{toHtml (index .Labels "prom_ql")}}{{end}}
{{if (index .Labels "trigger_value")}}trigger_value：{{index .Labels "trigger_value"}}{{end}}
{{if (index .Labels "host_ql")}}host_ql：{{toHtml (index .Labels "host_ql")}}{{end}}
{{if (index .Labels "region")}}region：{{index .Labels "region"}}{{end}}
{{if (index .Labels "cluster")}}cluster：{{index .Labels "cluster"}}{{end}}
{{if (index .Labels "business")}}business：{{index .Labels "business"}}{{end}}
{{if (index .Labels "service")}}service：{{index .Labels "service"}}{{end}}
{{if (index .Labels "env")}}env：{{index .Labels "env"}}{{end}}
{{if (index .Labels "type")}}type：{{index .Labels "type"}}{{end}}
{{if (index .Labels "topic")}}topic：{{index .Labels "topic"}}{{end}}
{{if (index .Labels "cpu")}}cpu：{{index .Labels "cpu"}}{{end}}
{{if (index .Labels "device")}}device：{{index .Labels "device"}}{{end}}
{{if (index .Labels "path")}}path：{{index .Labels "path"}}{{end}}
{{if (index .Labels "fstype")}}fstype：{{index .Labels "fstype"}}{{end}}
{{if (index .Labels "name")}}name：{{index .Labels "name"}}{{end}}
{{if (index .Labels "mode")}}mode：{{index .Labels "mode"}}{{end}}
{{if (index .Labels "runbook_url")}}runbook_url：{{toHtml (index .Labels "runbook_url")}}{{end}}
```

如下图所示：

<img src="https://download.flashcat.cloud/flashduty/changelog/20230720/wecom_app_render.png" alt="drawing" style="display: block; margin: 0 auto;" width="500"/>

**注意，企业微信限制了卡片长度，在模板渲染区域，您最多可以渲染不超过 8 行内容，超过 8 行的部分将被隐藏**



## Slack 应用
---
您需要预先配置 `集成中心-即时消息- Slack` 集成，才能发送消息卡片。如果不设置自定义内容，将采用系统默认模板，仅渲染常见标签信息：

```
{{if .Description}}*description* :{{toHtml .Labels.body_text .Description}}{{end}}
{{if .Labels.resource}}*resource* : {{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}
{{range $k, $v := .Labels}}
{{if not (in $k "resource" "body_text")}}*{{$k}}* : {{toHtml $v}}{{end}}{{end}}
```


如下图所示：

<img src="https://download.flashcat.cloud/flashduty/integration/slack/slack_app_message.png" alt="drawing" style="display: block; margin: 0 auto;" width="600"/>

如果您期望仅展示关键标签信息，可以参照下边的代码段：

- 我们列出了一些常见标签，您可自行删减；
- 消息可以发送长度为15000左右字符，超出后截断发送；
- 在 Slack 应用中，系统会自动帮您删除（因标签不存在导致的）渲染空行，您可放心配置

```
{{if (index .Labels "resource")}}*resource*：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}
{{if (index .Labels "metric")}}*metric*：{{index .Labels "metric"}}{{end}}
{{if (index .Labels "prom_ql")}}*prom_ql*：{{toHtml (index .Labels "prom_ql")}}{{end}}
{{if (index .Labels "trigger_value")}}*trigger_value*：{{index .Labels "trigger_value"}}{{end}}
{{if (index .Labels "host_ql")}}*host_ql*：{{index .Labels "host_ql"}}{{end}}
{{if (index .Labels "region")}}*region*：{{index .Labels "region"}}{{end}}
{{if (index .Labels "cluster")}}*cluster*：{{index .Labels "cluster"}}{{end}}
{{if (index .Labels "business")}}*business*：{{index .Labels "business"}}{{end}}
{{if (index .Labels "service")}}*service*：{{index .Labels "service"}}{{end}}
{{if (index .Labels "env")}}*env*：{{index .Labels "env"}}{{end}}
{{if (index .Labels "type")}}*type*：{{index .Labels "type"}}{{end}}
{{if (index .Labels "topic")}}*topic*：{{index .Labels "topic"}}{{end}}
{{if (index .Labels "cpu")}}*cpu*：{{index .Labels "cpu"}}{{end}}
{{if (index .Labels "device")}}*device*：{{index .Labels "device"}}{{end}}
{{if (index .Labels "path")}}*path*：{{index .Labels "path"}}{{end}}
{{if (index .Labels "fstype")}}*fstype*：{{index .Labels "fstype"}}{{end}}
{{if (index .Labels "name")}}*name*：{{index .Labels "name"}}{{end}}
{{if (index .Labels "mode")}}*mode*：{{index .Labels "mode"}}{{end}}
{{if (index .Labels "runbook_url")}}*runbook_url*：{{index .Labels "runbook_url"}}{{end}}
```



## Microsoft Teams 应用
---
您需要预先配置 `集成中心-即时消息- Microsoft Teams` 集成，才能发送消息卡片。如果不设置自定义内容，将采用系统默认模板，仅渲染常见标签信息：

```
{{if .Description}}**description** :{{toHtml .Labels.body_text .Description}}{{end}}
{{if .Labels.resource}}**resource** : {{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}
{{range $k, $v := .Labels}}
{{if not (in $k "resource" "body_text" "body_text_with_table")}}**{{$k}}** : {{toHtml $v}}{{end}}{{end}}
```


如下图所示：

<img src="https://download.flashcat.cloud/flashduty/integration/microsoft-teams/teams_app_message.png" alt="drawing" style="display: block; margin: 0 auto;" width="300"/>

如果您期望仅展示关键标签信息，可以参照下边的代码段：

- 我们列出了一些常见标签，您可自行删减；
- 消息可以发送长度为 28KB 左右字节，超出后报错；
- 在 Microsoft Teams 应用中，系统会自动帮您删除（因标签不存在导致的）渲染空行，您可放心配置

```
{{if (index .Labels "resource")}}**resource**：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}
{{if (index .Labels "metric")}}**metric**：{{index .Labels "metric"}}{{end}}
{{if (index .Labels "prom_ql")}}**prom_ql**：{{toHtml (index .Labels "prom_ql")}}{{end}}
{{if (index .Labels "trigger_value")}}**trigger_value**：{{index .Labels "trigger_value"}}{{end}}
{{if (index .Labels "host_ql")}}**host_ql**：{{index .Labels "host_ql"}}{{end}}
{{if (index .Labels "region")}}**region**：{{index .Labels "region"}}{{end}}
{{if (index .Labels "cluster")}}**cluster**：{{index .Labels "cluster"}}{{end}}
{{if (index .Labels "business")}}**business**：{{index .Labels "business"}}{{end}}
{{if (index .Labels "service")}}**service**：{{index .Labels "service"}}{{end}}
{{if (index .Labels "env")}}**env**：{{index .Labels "env"}}{{end}}
{{if (index .Labels "type")}}**type**：{{index .Labels "type"}}{{end}}
{{if (index .Labels "topic")}}**topic**：{{index .Labels "topic"}}{{end}}
{{if (index .Labels "cpu")}}**cpu**：{{index .Labels "cpu"}}{{end}}
{{if (index .Labels "device")}}**device**：{{index .Labels "device"}}{{end}}
{{if (index .Labels "path")}}**path**：{{index .Labels "path"}}{{end}}
{{if (index .Labels "fstype")}}**fstype**：{{index .Labels "fstype"}}{{end}}
{{if (index .Labels "name")}}**name**：{{index .Labels "name"}}{{end}}
{{if (index .Labels "mode")}}**mode**：{{index .Labels "mode"}}{{end}}
{{if (index .Labels "runbook_url")}}**runbook_url**：{{index .Labels "runbook_url"}}{{end}}
```





## Microsoft Teams 应用
---
您需要预先配置 `集成中心-即时消息- Microsoft Teams` 集成，才能发送消息卡片。如果不设置自定义内容，将采用系统默认模板，仅渲染常见标签信息：

```
{{if .Description}}**description** :{{toHtml .Labels.body_text .Description}}{{end}}
{{if .Labels.resource}}**resource** : {{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}
{{range $k, $v := .Labels}}
{{if not (in $k "resource" "body_text" "body_text_with_table")}}**{{$k}}** : {{toHtml $v}}{{end}}{{end}}
```


如下图所示：

<img src="https://download.flashcat.cloud/flashduty/integration/microsoft-teams/teams_app_message.png" alt="drawing" style="display: block; margin: 0 auto;" width="300"/>

如果您期望仅展示关键标签信息，可以参照下边的代码段：

- 我们列出了一些常见标签，您可自行删减；
- 消息可以发送长度为 28KB 左右字节，超出后报错；
- 在 Microsoft Teams 应用中，系统会自动帮您删除（因标签不存在导致的）渲染空行，您可放心配置

```
{{if (index .Labels "resource")}}**resource**：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}
{{if (index .Labels "metric")}}**metric**：{{index .Labels "metric"}}{{end}}
{{if (index .Labels "prom_ql")}}**prom_ql**：{{toHtml (index .Labels "prom_ql")}}{{end}}
{{if (index .Labels "trigger_value")}}**trigger_value**：{{index .Labels "trigger_value"}}{{end}}
{{if (index .Labels "host_ql")}}**host_ql**：{{index .Labels "host_ql"}}{{end}}
{{if (index .Labels "region")}}**region**：{{index .Labels "region"}}{{end}}
{{if (index .Labels "cluster")}}**cluster**：{{index .Labels "cluster"}}{{end}}
{{if (index .Labels "business")}}**business**：{{index .Labels "business"}}{{end}}
{{if (index .Labels "service")}}**service**：{{index .Labels "service"}}{{end}}
{{if (index .Labels "env")}}**env**：{{index .Labels "env"}}{{end}}
{{if (index .Labels "type")}}**type**：{{index .Labels "type"}}{{end}}
{{if (index .Labels "topic")}}**topic**：{{index .Labels "topic"}}{{end}}
{{if (index .Labels "cpu")}}**cpu**：{{index .Labels "cpu"}}{{end}}
{{if (index .Labels "device")}}**device**：{{index .Labels "device"}}{{end}}
{{if (index .Labels "path")}}**path**：{{index .Labels "path"}}{{end}}
{{if (index .Labels "fstype")}}**fstype**：{{index .Labels "fstype"}}{{end}}
{{if (index .Labels "name")}}**name**：{{index .Labels "name"}}{{end}}
{{if (index .Labels "mode")}}**mode**：{{index .Labels "mode"}}{{end}}
{{if (index .Labels "runbook_url")}}**runbook_url**：{{index .Labels "runbook_url"}}{{end}}
```



## 飞书机器人
---
飞书机器人仅支持发送纯文本消息。

- 消息`最大长度为4000字节，超出后截断发送`；
- 如果文本中包含`<br>`，渲染时会`先删除空行，再将<br>替换为换行符`；
- 如果不设置自定义内容，将采用系统默认模板，仅展示关键信息：

```
{{fireReason .}}INC #{{.Num}} {{toHtml .Title}}
-----
协作空间：{{if .ChannelName}}{{.ChannelName}}{{else}}无{{end}}
严重程度：{{.IncidentSeverity}}
触发时间：{{date "2006-01-02 15:04:05" .StartTime}}
持续时长：{{ago .StartTime}}{{if gt .AlertCnt 1}}
聚合告警：{{.AlertCnt}}条{{end}}{{if .Labels.resource}}
告警对象：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}{{if .Description}}
故障描述：{{toHtml .Description}}{{end}}{{if gt (len .Responders) 0}}
分派人员：{{range .Responders}}@{{.PersonName}} {{end}}{{end}}
<br>详情：{{.DetailUrl}}
```



## 钉钉机器人
---
钉钉机器人仅支持发送 Markdown 消息（[语法限制](https://open.dingtalk.com/document/robots/custom-robot-access#title-7ur-3ok-s1a)）。

- 消息`最大长度为4000字节，超出后截断发送`；
- 如果文本中包含`<br>`，渲染时会`先删除空行，再将<br>替换为换行符`；
- 如果不设置自定义内容，将采用系统默认模板，仅展示关键信息：

```
{{fireReason .}}INC [#{{.Num}}]({{.DetailUrl}}) {{toHtml .Title}}

---
- 协作空间：{{if .ChannelName}}{{.ChannelName}}{{else}}无{{end}}
- 严重程度：{{$s := colorSeverity .IncidentSeverity}}{{toHtml $s}}
- 触发时间：{{date "2006-01-02 15:04:05" .StartTime}}
- 持续时长：{{ago .StartTime}}{{if gt .AlertCnt 1}}
- 聚合告警：{{.AlertCnt}}条{{end}}{{if .Labels.resource}}
- 告警对象：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}{{if .Description}}
- 故障描述：{{toHtml .Description}}{{end}}{{if gt (len .Responders) 0}}
- 分派人员：{{range .Responders}}@{{.PersonName}} {{end}}{{end}}
---
<br>[详情]({{.DetailUrl}})|[认领]({{.DetailUrl}}?ack=1)
```



## 企业微信机器人
---
企微机器人仅支持发送 Markdown 消息（[语法限制](https://developer.work.weixin.qq.com/document/path/91770#markdown%E7%B1%BB%E5%9E%8B)）。

- 消息`最大长度为4000字节，超出后截断发送`；
- 如果文本中包含`<br>`，渲染时会`先删除空行，再将<br>替换为换行符`；
- 如果不设置自定义内容，将采用系统默认模板，仅展示关键信息：

```
{{fireReason .}}**INC [#{{.Num}}]({{.DetailUrl}}) {{toHtml .Title}}**
> 协作空间：<font color="warning">{{if .ChannelName}}{{.ChannelName}}{{else}}无{{end}}</font>
> 严重程度：<font color="warning">{{.IncidentSeverity}}</font>
> 触发时间：{{date "2006-01-02 15:04:05" .StartTime}}
> 持续时长：{{ago .StartTime}}{{if gt .AlertCnt 1}}
> 聚合告警：{{.AlertCnt}}条{{end}}{{if .Labels.resource}}
> 告警对象：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}{{if .Description}}
> 故障描述：{{toHtml .Description}}{{end}}{{if gt (len .Responders) 0}}
> 分派人员：{{range .Responders}}@{{.PersonName}} {{end}}{{end}}
<br>[详情]({{.DetailUrl}})|[认领]({{.DetailUrl}}?ack=1)
```



## Telegram 机器人
---
- 配置国内能访问的Telegram服务地址；
- 消息`最大长度为4096字符，超出后不发送`；
- 如果文本中包含`<br>`，渲染时会`先删除空行，再将<br>替换为换行符`；
- 如果不设置自定义内容，将采用系统默认模板，仅展示关键信息：

```
{{fireReason .}}INC [#{{.Num}}]({{.DetailUrl}}) {{toHtml .Title}}
-----
协作空间：{{if .ChannelName}}{{.ChannelName}}{{else}}无{{end}}
严重程度：{{.IncidentSeverity}}
触发时间：{{date "2006-01-02 15:04:05" .StartTime}}
持续时长：{{ago .StartTime}}{{if gt .AlertCnt 1}}
聚合告警：{{.AlertCnt}}条{{end}}{{if .Labels.resource}}
告警对象：{{toHtml (joinAlertLabels . "resource" ", ")}}({{.Labels.resource}}){{end}}{{if .Description}}
故障描述：{{toHtml .Description}}{{end}}{{if gt (len .Responders) 0}}
分派人员：{{range .Responders}}@{{.PersonName}} {{end}}{{end}}

<br>[详情]({{.DetailUrl}})|[认领]({{.DetailUrl}}?ack=1)
```



## Slack 机器人
---
- 消息`可以发送长度为15000左右字符，超出后截断发送`；
- 如果文本中包含`<br>`，渲染时会`先删除空行，再将<br>替换为换行符`；
- 如果不设置自定义内容，将采用系统默认模板，仅展示关键信息：

```
{{fireReason .}}INC <{{.DetailUrl}}|#{{.Num}}> {{toHtml .Title}}
-----
协作空间：{{if .ChannelName}}{{.ChannelName}}{{else}}无{{end}}
严重程度：{{.IncidentSeverity}}
触发时间：{{date "2006-01-02 15:04:05" .StartTime}}
持续时长：{{ago .StartTime}}{{if gt .AlertCnt 1}}
聚合告警：{{.AlertCnt}}条{{end}}{{if .Labels.resource}}
告警对象：{{toHtml (joinAlertLabels . "resource" ", ")}}{{end}}{{if .Description}}
故障描述：{{toHtml .Description}}{{end}}{{if gt (len .Responders) 0}}
分派人员：{{range .Responders}}@{{.PersonName}} {{end}}{{end}}
-----
<br><{{.DetailUrl}}|详情>|<{{.DetailUrl}}?ack=1|认领>
```
